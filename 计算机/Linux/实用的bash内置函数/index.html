


<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.4.0">
    
    
      
        <title>实用的bash内置函数 - Baby King's Wiki</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.fe0cca5b.min.css">
      
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.a46bcfb3.min.css">
      
      
        
        
        <meta name="theme-color" content="#03a9f4">
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="light-blue" data-md-color-accent="pink">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../../.." title="Baby King's Wiki" class="md-header-nav__button md-logo" aria-label="Baby King's Wiki">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Baby King's Wiki
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              实用的bash内置函数
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Baby King's Wiki" class="md-nav__button md-logo" aria-label="Baby King's Wiki">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Baby King's Wiki
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      计算机
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="计算机" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        计算机
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-1" type="checkbox" id="nav-2-1">
    
    <label class="md-nav__link" for="nav-2-1">
      CSS
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="CSS" data-md-level="2">
      <label class="md-nav__title" for="nav-2-1">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        CSS
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../CSS/clear%E7%90%86%E8%A7%A3%E9%94%99%E8%AF%AF/" title="Clear理解错误" class="md-nav__link">
      Clear理解错误
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../CSS/css%E5%88%9D%E5%AD%A6%E8%80%85%E9%9C%80%E8%A6%81%E7%90%86%E8%A7%A3%E7%9A%84%E6%A6%82%E5%BF%B5/" title="Css初学者需要理解的概念" class="md-nav__link">
      Css初学者需要理解的概念
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../CSS/%E7%9B%92%E5%AD%90%E7%9A%84%E7%90%86%E8%A7%A3/" title="盒子的理解" class="md-nav__link">
      盒子的理解
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../CSS/%E9%80%89%E6%8B%A9%E5%99%A8%E7%9A%84%E7%90%86%E8%A7%A3/" title="选择器的理解" class="md-nav__link">
      选择器的理解
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-2" type="checkbox" id="nav-2-2">
    
    <label class="md-nav__link" for="nav-2-2">
      Emacs
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Emacs" data-md-level="2">
      <label class="md-nav__title" for="nav-2-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Emacs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Emacs/Emacs%E5%BF%AB%E6%8D%B7%E9%94%AE/" title="Emacs快捷键" class="md-nav__link">
      Emacs快捷键
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-3" type="checkbox" id="nav-2-3">
    
    <label class="md-nav__link" for="nav-2-3">
      Git
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Git" data-md-level="2">
      <label class="md-nav__title" for="nav-2-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Git
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Git/Git%E5%8F%82%E8%80%83%E8%B5%84%E6%BA%90/" title="Git参考资源" class="md-nav__link">
      Git参考资源
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Git/Git%E5%A4%9A%E5%B8%90%E5%8F%B7%E8%AE%BE%E7%BD%AE/" title="Git多帐号设置" class="md-nav__link">
      Git多帐号设置
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Git/Git%E5%AF%86%E7%A0%81/" title="Git密码" class="md-nav__link">
      Git密码
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Git/Git%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/" title="Git常见问题" class="md-nav__link">
      Git常见问题
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Git/%E6%97%A5%E5%B8%B8%E6%93%8D%E4%BD%9C/" title="日常操作" class="md-nav__link">
      日常操作
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-4" type="checkbox" id="nav-2-4">
    
    <label class="md-nav__link" for="nav-2-4">
      Go
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Go" data-md-level="2">
      <label class="md-nav__title" for="nav-2-4">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Go
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Go/GoCheatSheet/" title="Go Cheat Sheet" class="md-nav__link">
      Go Cheat Sheet
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Go/Go%E5%88%9D%E5%AD%A6%E8%80%85%E7%9A%84%E9%97%AE%E9%A2%98/" title="Go初学者的问题" class="md-nav__link">
      Go初学者的问题
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-5" type="checkbox" id="nav-2-5">
    
    <label class="md-nav__link" for="nav-2-5">
      Java
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Java" data-md-level="2">
      <label class="md-nav__title" for="nav-2-5">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Java
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Java/%E5%BE%85%E6%95%B4%E7%90%86/" title="待整理" class="md-nav__link">
      待整理
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-6" type="checkbox" id="nav-2-6" checked>
    
    <label class="md-nav__link" for="nav-2-6">
      Linux
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Linux" data-md-level="2">
      <label class="md-nav__title" for="nav-2-6">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Linux
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../CentOS%E6%97%A5%E5%B8%B8/" title="CentOS日常" class="md-nav__link">
      CentOS日常
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../linux%E5%91%BD%E4%BB%A4%E5%88%86%E7%B1%BB%E5%8F%82%E8%80%83/" title="Linux命令分类参考" class="md-nav__link">
      Linux命令分类参考
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        实用的bash内置函数
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg>
        </span>
      </label>
    
    <a href="./" title="实用的bash内置函数" class="md-nav__link md-nav__link--active">
      实用的bash内置函数
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      目录
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    实用内置函数
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-7" type="checkbox" id="nav-2-7">
    
    <label class="md-nav__link" for="nav-2-7">
      Python
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Python" data-md-level="2">
      <label class="md-nav__title" for="nav-2-7">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Python
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Python/pyenv%E7%9A%84%E5%AE%89%E8%A3%85%E4%BF%A1%E6%81%AF/" title="Pyenv的安装信息" class="md-nav__link">
      Pyenv的安装信息
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Python/pyinstaller%E5%AE%89%E8%A3%85/" title="Pyinstaller安装" class="md-nav__link">
      Pyinstaller安装
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-8" type="checkbox" id="nav-2-8">
    
    <label class="md-nav__link" for="nav-2-8">
      Ruby
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Ruby" data-md-level="2">
      <label class="md-nav__title" for="nav-2-8">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Ruby
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Ruby/Rails%E7%AC%94%E8%AE%B0/" title="Rails笔记" class="md-nav__link">
      Rails笔记
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Ruby/Ruby%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="Ruby的一些笔记" class="md-nav__link">
      Ruby的一些笔记
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-9" type="checkbox" id="nav-2-9">
    
    <label class="md-nav__link" for="nav-2-9">
      Shell
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Shell" data-md-level="2">
      <label class="md-nav__title" for="nav-2-9">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Shell
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Shell/Bash%E9%80%9F%E6%9F%A5%E5%8F%82%E8%80%83/" title="Bash速查参考" class="md-nav__link">
      Bash速查参考
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Shell/bash%E5%91%BD%E4%BB%A4%E5%AE%9E%E4%BE%8B/" title="Bash命令实例" class="md-nav__link">
      Bash命令实例
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Shell/shell%E5%88%9D%E5%AD%A6%E8%80%85%E5%8F%82%E8%80%83/" title="Shell初学者参考" class="md-nav__link">
      Shell初学者参考
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Shell/%E5%A4%84%E7%90%86utf8/" title="处理utf8" class="md-nav__link">
      处理utf8
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Shell/%E6%93%8D%E4%BD%9C%E5%A4%9A%E8%A1%8C%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8F%98%E9%87%8F/" title="操作多行字符串变量" class="md-nav__link">
      操作多行字符串变量
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Shell/%E8%A7%A3%E8%AF%BBpyenv%E7%9A%84shell/" title="解读pyenv的shell" class="md-nav__link">
      解读pyenv的shell
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-10" type="checkbox" id="nav-2-10">
    
    <label class="md-nav__link" for="nav-2-10">
      Android
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Android" data-md-level="2">
      <label class="md-nav__title" for="nav-2-10">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Android
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../android/android%E7%B1%BB%E5%BA%93%E7%B1%BB%E5%85%B3%E7%B3%BB%E5%9B%BE/" title="Android类库类关系图" class="md-nav__link">
      Android类库类关系图
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-11" type="checkbox" id="nav-2-11">
    
    <label class="md-nav__link" for="nav-2-11">
      iOS
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="iOS" data-md-level="2">
      <label class="md-nav__title" for="nav-2-11">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        iOS
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../iOS/iPad%20Pro%E7%9A%84%E4%BD%BF%E7%94%A8/" title="iPad Pro的使用" class="md-nav__link">
      iPad Pro的使用
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-12" type="checkbox" id="nav-2-12">
    
    <label class="md-nav__link" for="nav-2-12">
      macOS
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="macOS" data-md-level="2">
      <label class="md-nav__title" for="nav-2-12">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        macOS
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../macOS/block_weak_strong/" title="\_\_block & \_\_weak & \_\_strong" class="md-nav__link">
      \_\_block & \_\_weak & \_\_strong
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../macOS/macOS-iOS%E5%BC%80%E5%8F%91%E5%B8%B8%E7%94%A8%E7%9A%84%E6%A1%86%E6%9E%B6%E5%92%8C%E5%BA%93/" title="macOS iOS开发常用的框架和库" class="md-nav__link">
      macOS iOS开发常用的框架和库
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../macOS/nsstring%E4%B8%BA%E4%BD%95%E8%A6%81%E7%94%A8copy/" title="NSString为何要用copy？而不是strong？" class="md-nav__link">
      NSString为何要用copy？而不是strong？
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-13" type="checkbox" id="nav-2-13">
    
    <label class="md-nav__link" for="nav-2-13">
      Mac软件
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Mac软件" data-md-level="2">
      <label class="md-nav__title" for="nav-2-13">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Mac软件
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../mac%E8%BD%AF%E4%BB%B6/Homebrew%E7%9B%B8%E5%85%B3/" title="Homebrew相关" class="md-nav__link">
      Homebrew相关
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mac%E8%BD%AF%E4%BB%B6/Keynote/" title="Keynote" class="md-nav__link">
      Keynote
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mac%E8%BD%AF%E4%BB%B6/Tmux%E6%8C%87%E5%8D%97/" title="Tmux指南" class="md-nav__link">
      Tmux指南
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mac%E8%BD%AF%E4%BB%B6/iTerm2%E7%9A%84%E8%AE%BE%E7%BD%AE/" title="iTerm2的设置" class="md-nav__link">
      iTerm2的设置
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-14" type="checkbox" id="nav-2-14">
    
    <label class="md-nav__link" for="nav-2-14">
      其他
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="其他" data-md-level="2">
      <label class="md-nav__title" for="nav-2-14">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        其他
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E5%85%B6%E4%BB%96/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9B%B8%E5%85%B3%E8%B5%84%E6%BA%90%E6%95%B4%E7%90%86/" title="计算机相关资源整理" class="md-nav__link">
      计算机相关资源整理
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-15" type="checkbox" id="nav-2-15">
    
    <label class="md-nav__link" for="nav-2-15">
      前端
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="前端" data-md-level="2">
      <label class="md-nav__title" for="nav-2-15">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        前端
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E5%89%8D%E7%AB%AF/javascript%E4%B8%AD%E7%9A%84this/" title="Javascript中的this" class="md-nav__link">
      Javascript中的this
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-16" type="checkbox" id="nav-2-16">
    
    <label class="md-nav__link" for="nav-2-16">
      效率工具
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="效率工具" data-md-level="2">
      <label class="md-nav__title" for="nav-2-16">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        效率工具
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E6%95%88%E7%8E%87%E5%B7%A5%E5%85%B7/Keyboard_Maestro%E7%9B%B8%E5%85%B3/" title="Keyboard Maestro相关" class="md-nav__link">
      Keyboard Maestro相关
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E6%95%88%E7%8E%87%E5%B7%A5%E5%85%B7/alfred%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E4%BD%BF%E7%94%A8/" title="Alfred环境变量使用" class="md-nav__link">
      Alfred环境变量使用
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E6%95%88%E7%8E%87%E5%B7%A5%E5%85%B7/togglecapslock%E5%BC%80%E5%85%B3%E6%8E%A7%E5%88%B6asdw%E6%96%B9%E5%90%91%E9%94%AE/" title="Togglecapslock开关控制asdw方向键" class="md-nav__link">
      Togglecapslock开关控制asdw方向键
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-17" type="checkbox" id="nav-2-17">
    
    <label class="md-nav__link" for="nav-2-17">
      数据库
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="数据库" data-md-level="2">
      <label class="md-nav__title" for="nav-2-17">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        数据库
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" title="MySQL常用命令" class="md-nav__link">
      MySQL常用命令
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E6%95%B0%E6%8D%AE%E5%BA%93/Mysql%E4%B8%ADjoin%E7%9A%84%E5%8C%BA%E5%88%AB/" title="Mysql中join的区别" class="md-nav__link">
      Mysql中join的区别
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-18" type="checkbox" id="nav-2-18">
    
    <label class="md-nav__link" for="nav-2-18">
      正则表达式
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="正则表达式" data-md-level="2">
      <label class="md-nav__title" for="nav-2-18">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        正则表达式
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/%E6%AD%A3%E5%88%99%E7%AC%94%E8%AE%B0/" title="正则笔记" class="md-nav__link">
      正则笔记
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-19" type="checkbox" id="nav-2-19">
    
    <label class="md-nav__link" for="nav-2-19">
      编译调试
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="编译调试" data-md-level="2">
      <label class="md-nav__title" for="nav-2-19">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        编译调试
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E7%BC%96%E8%AF%91%E8%B0%83%E8%AF%95/GDB-Cheat/" title="GDB Cheat Sheet" class="md-nav__link">
      GDB Cheat Sheet
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-20" type="checkbox" id="nav-2-20">
    
    <label class="md-nav__link" for="nav-2-20">
      编辑与编辑器
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="编辑与编辑器" data-md-level="2">
      <label class="md-nav__title" for="nav-2-20">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        编辑与编辑器
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E7%BC%96%E8%BE%91%E4%B8%8E%E7%BC%96%E8%BE%91%E5%99%A8/Markdown%E6%8B%BE%E9%81%97/" title="Markdown拾遗" class="md-nav__link">
      Markdown拾遗
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E7%BC%96%E8%BE%91%E4%B8%8E%E7%BC%96%E8%BE%91%E5%99%A8/Typora/" title="Typora" class="md-nav__link">
      Typora
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E7%BC%96%E8%BE%91%E4%B8%8E%E7%BC%96%E8%BE%91%E5%99%A8/VIM%E5%8F%82%E8%80%83/" title="VIM参考" class="md-nav__link">
      VIM参考
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E7%BC%96%E8%BE%91%E4%B8%8E%E7%BC%96%E8%BE%91%E5%99%A8/VSCode%E5%8F%82%E8%80%83/" title="VSCode参考" class="md-nav__link">
      VSCode参考
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-21" type="checkbox" id="nav-2-21">
    
    <label class="md-nav__link" for="nav-2-21">
      计算机网络
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="计算机网络" data-md-level="2">
      <label class="md-nav__title" for="nav-2-21">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        计算机网络
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/Nginx%E4%B8%BA%E4%BB%80%E4%B9%88%E5%8F%AB%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/" title="Nginx为什么叫反向代理" class="md-nav__link">
      Nginx为什么叫反向代理
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      音乐
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="音乐" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        音乐
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../%E9%9F%B3%E4%B9%90/%E4%BB%80%E4%B9%88%E6%98%AF%E8%B0%83%E6%80%A7/" title="什么是调性？什么是大小调式?!" class="md-nav__link">
      什么是调性？什么是大小调式?!
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      目录
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    实用内置函数
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  
                
                
                  <h1>实用的bash内置函数</h1>
                
                <h3 id="_1">实用内置函数<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># check current os is linux</span>
<span class="k">function</span> cf_is_linux<span class="o">()</span> <span class="o">{</span>
  <span class="o">[[</span> <span class="s2">&quot;</span><span class="nv">$OSTYPE</span><span class="s2">&quot;</span> <span class="o">=</span> *linux* <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;true&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">0</span>
  <span class="nb">echo</span> <span class="s2">&quot;false&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
<span class="o">}</span>

<span class="c1"># check current os is mac/darwin</span>
<span class="k">function</span> cf_is_darwin<span class="o">()</span> <span class="o">{</span>
  <span class="o">[[</span> <span class="s2">&quot;</span><span class="nv">$OSTYPE</span><span class="s2">&quot;</span> <span class="o">=</span> *darwin* <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;true&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">0</span>
  <span class="nb">echo</span> <span class="s2">&quot;false&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
<span class="o">}</span>

<span class="c1"># check current os is windows/cygwin</span>
<span class="k">function</span> cf_is_cygwin<span class="o">()</span> <span class="o">{</span>
  <span class="o">[[</span> <span class="s2">&quot;</span><span class="nv">$OSTYPE</span><span class="s2">&quot;</span> <span class="o">=</span> *cygwin* <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;true&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">0</span>
  <span class="nb">echo</span> <span class="s2">&quot;false&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
<span class="o">}</span>

<span class="k">function</span> cf_is_gnu_date<span class="o">()</span> <span class="o">{</span>
  date --version &gt;/dev/null <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;true&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">0</span>
  <span class="nb">echo</span> <span class="s2">&quot;false&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
<span class="o">}</span>

<span class="k">function</span> cf_is_gnu_sed<span class="o">()</span> <span class="o">{</span>
  sed --version &gt;/dev/null <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;true&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">0</span>
  <span class="nb">echo</span> <span class="s2">&quot;false&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
<span class="o">}</span>

<span class="k">function</span> cf_is_gnu_awk<span class="o">()</span> <span class="o">{</span>
  awk --version <span class="p">|</span> grep GNU &gt;/dev/null <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;true&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">0</span>
  <span class="nb">echo</span> <span class="s2">&quot;false&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
<span class="o">}</span>

<span class="k">function</span> cf_is_gnu_grep<span class="o">()</span> <span class="o">{</span>
  grep --version <span class="p">|</span> grep GNU &gt;/dev/null <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;true&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">0</span>
  <span class="nb">echo</span> <span class="s2">&quot;false&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
<span class="o">}</span>

<span class="c1"># java style startsWith</span>
<span class="k">function</span> cf_starts_with<span class="o">()</span> <span class="o">{</span>
  <span class="nb">local</span> <span class="nv">str</span><span class="o">=</span><span class="nv">$1</span>
  <span class="nb">local</span> <span class="nv">pre</span><span class="o">=</span><span class="nv">$2</span>
  <span class="o">[[</span> <span class="s2">&quot;</span><span class="nv">$str</span><span class="s2">&quot;</span> <span class="o">==</span>  <span class="si">${</span><span class="nv">pre</span><span class="si">}</span>* <span class="o">]]</span>
<span class="o">}</span>

<span class="c1"># java style substring</span>
<span class="k">function</span> cf_substring<span class="o">()</span> <span class="o">{</span>
  <span class="nb">local</span> <span class="nv">str</span><span class="o">=</span><span class="nv">$1</span>
  <span class="nb">local</span> <span class="nv">begin</span><span class="o">=</span><span class="nv">$2</span>
  <span class="nb">local</span> <span class="nv">end</span><span class="o">=</span><span class="nv">$3</span>
  <span class="k">if</span> <span class="o">[</span> -z <span class="s2">&quot;</span><span class="nv">$end</span><span class="s2">&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nb">echo</span> <span class="si">${</span><span class="nv">str</span><span class="p">:</span><span class="nv">$begin</span><span class="si">}</span> 
  <span class="k">else</span>
    <span class="nb">local</span> <span class="nv">len</span><span class="o">=</span><span class="sb">`</span>expr <span class="nv">$end</span> - <span class="nv">$begin</span><span class="sb">`</span>
    <span class="nb">echo</span> <span class="si">${</span><span class="nv">str</span><span class="p">:</span><span class="nv">$begin</span><span class="p">:</span><span class="nv">$len</span><span class="si">}</span>
  <span class="k">fi</span>
<span class="o">}</span>

<span class="c1"># get current shell name</span>
<span class="k">function</span> cf_shell_name<span class="o">()</span> <span class="o">{</span>
  <span class="nb">local</span> <span class="nv">name</span><span class="o">=</span><span class="k">$(</span> ps -ocommand<span class="o">=</span> -p <span class="nv">$$</span> <span class="p">|</span> awk <span class="s1">&#39;{print $1}&#39;</span><span class="k">)</span>
  <span class="k">if</span> cf_starts_with <span class="nv">$name</span> <span class="s2">&quot;-&quot;</span><span class="p">;</span> <span class="k">then</span>
    cf_substring <span class="nv">$name</span> <span class="m">1</span>
  <span class="k">else</span>
    <span class="nb">echo</span> <span class="nv">$name</span>
  <span class="k">fi</span>
<span class="o">}</span>

<span class="c1"># check current shell is bash</span>
<span class="k">function</span> cf_is_bash<span class="o">()</span> <span class="o">{</span>
  <span class="o">[[</span> <span class="sb">`</span>cf_shell_name<span class="sb">`</span> <span class="o">=</span> <span class="s2">&quot;-bash&quot;</span> <span class="o">||</span> <span class="sb">`</span>basename <span class="k">$(</span>cf_shell_name<span class="k">)</span><span class="sb">`</span> <span class="o">=</span> <span class="s2">&quot;bash&quot;</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;true&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">0</span>
  <span class="nb">echo</span> <span class="s2">&quot;false&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
<span class="o">}</span>

<span class="c1"># check current shell is zsh</span>
<span class="k">function</span> cf_is_zsh<span class="o">()</span> <span class="o">{</span>
  <span class="o">[[</span> <span class="sb">`</span>cf_shell_name<span class="sb">`</span> <span class="o">=</span> <span class="s2">&quot;-zsh&quot;</span> <span class="o">||</span> <span class="sb">`</span>basename <span class="k">$(</span>cf_shell_name<span class="k">)</span><span class="sb">`</span> <span class="o">=</span> <span class="s2">&quot;zsh&quot;</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;true&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">0</span>
  <span class="nb">echo</span> <span class="s2">&quot;false&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
<span class="o">}</span>

<span class="k">function</span> _script_dir<span class="o">()</span> <span class="o">{</span>
  <span class="k">if</span> cf_is_bash &gt;/dev/null<span class="p">;</span> <span class="k">then</span>
    <span class="nb">cd</span> <span class="s2">&quot;</span><span class="k">$(</span> dirname <span class="s2">&quot;</span><span class="si">${</span><span class="nv">BASH_SOURCE</span><span class="p">[0]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">)</span><span class="s2">&quot;</span> <span class="o">&amp;&amp;</span> <span class="nb">pwd</span> -P 
  <span class="k">elif</span> cf_is_zsh &gt;/dev/null<span class="p">;</span> <span class="k">then</span>
    <span class="nb">cd</span> <span class="s2">&quot;</span><span class="k">$(</span> dirname <span class="s2">&quot;</span><span class="si">${</span><span class="p">(%)</span><span class="k">:-</span><span class="p">%N</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">)</span><span class="s2">&quot;</span> <span class="o">&amp;&amp;</span> <span class="nb">pwd</span> -P 
  <span class="k">else</span>
    <span class="nb">echo</span> <span class="s2">&quot;unsupported shell&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
  <span class="k">fi</span>
<span class="o">}</span>

<span class="k">function</span> _script_file<span class="o">()</span> <span class="o">{</span>
  <span class="k">if</span> cf_is_bash &gt;/dev/null<span class="p">;</span> <span class="k">then</span>
    basename <span class="s2">&quot;</span><span class="si">${</span><span class="nv">BASH_SOURCE</span><span class="p">[0]</span><span class="si">}</span><span class="s2">&quot;</span> 
  <span class="k">elif</span> cf_is_zsh &gt;/dev/null<span class="p">;</span> <span class="k">then</span>
    basename <span class="s2">&quot;</span><span class="si">${</span><span class="p">(%)</span><span class="k">:-</span><span class="p">%N</span><span class="si">}</span><span class="s2">&quot;</span> 
  <span class="k">else</span>
    <span class="nb">echo</span> <span class="s2">&quot;unsupported shell&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
  <span class="k">fi</span>
<span class="o">}</span>

<span class="c1"># colorful grep. private function</span>
<span class="k">function</span> _get_colorful_grep<span class="o">()</span> <span class="o">{</span>
  cf_is_gnu_grep &gt;/dev/null <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;grep --color&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">0</span>
  <span class="nb">export</span> <span class="nv">GREP_OPTIONS</span><span class="o">=</span><span class="s1">&#39;--color=always&#39;</span>
  <span class="nb">export</span> <span class="nv">GREP_COLOR</span><span class="o">=</span><span class="s1">&#39;1;35;40&#39;</span>
  <span class="nb">echo</span> <span class="s2">&quot;grep&quot;</span> 
<span class="o">}</span>

<span class="c1"># list all common functions</span>
<span class="k">function</span> cf_functions<span class="o">()</span> <span class="o">{</span>
  <span class="k">if</span> cf_is_bash &gt;/dev/null<span class="p">;</span> <span class="k">then</span>
    <span class="nb">declare</span> -F <span class="p">|</span> awk <span class="s1">&#39;{print $NF}&#39;</span> <span class="p">|</span> grep <span class="s2">&quot;cf_&quot;</span> <span class="p">|</span> sort
  <span class="k">elif</span> cf_is_zsh &gt;/dev/null<span class="p">;</span> <span class="k">then</span>
    print -l <span class="si">${</span><span class="p">(ok)functions</span><span class="si">}</span> <span class="p">|</span> grep <span class="s2">&quot;cf_&quot;</span> <span class="p">|</span> sort
  <span class="k">else</span>
    <span class="nb">echo</span> <span class="s2">&quot;unsupported shell&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
  <span class="k">fi</span>
<span class="o">}</span>

<span class="c1"># get total memory (MB)</span>
<span class="k">function</span> cf_mem_total<span class="o">()</span> <span class="o">{</span>
  <span class="k">if</span> cf_is_linux &gt;/dev/null<span class="p">;</span> <span class="k">then</span>
    free -m <span class="p">|</span> awk <span class="s1">&#39;/^Mem/{print $2&quot;M&quot;}&#39;</span>
  <span class="k">elif</span> cf_is_darwin &gt;/dev/null<span class="p">;</span> <span class="k">then</span>
    sysctl hw.memsize <span class="p">|</span> awk <span class="s1">&#39;{print $2/1024/1024&quot;M&quot;}&#39;</span>
  <span class="k">else</span>
    <span class="nb">echo</span> <span class="s2">&quot;unsupported os&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
  <span class="k">fi</span> 
<span class="o">}</span>

<span class="c1"># decimal to hexadecimal</span>
<span class="k">function</span> cf_dec2Hex<span class="o">()</span> <span class="o">{</span>
  <span class="nb">printf</span> <span class="s2">&quot;%x&quot;</span> <span class="nv">$1</span>
<span class="o">}</span>

<span class="c1"># decimal to octal </span>
<span class="k">function</span> cf_dec2Oct<span class="o">()</span> <span class="o">{</span>
  <span class="nb">printf</span> <span class="s2">&quot;%o&quot;</span> <span class="nv">$1</span>
<span class="o">}</span>

<span class="c1"># decimal to binary</span>
<span class="k">function</span> cf_dec2Bin<span class="o">()</span> <span class="o">{</span>
  <span class="nb">echo</span> <span class="s2">&quot;obase=2; </span><span class="nv">$1</span><span class="s2">&quot;</span> <span class="p">|</span> bc
<span class="o">}</span>

<span class="c1"># hexadecimal to decimal </span>
<span class="k">function</span> cf_hex2Dec<span class="o">()</span> <span class="o">{</span>
  <span class="nb">echo</span> <span class="k">$((</span><span class="m">16#</span><span class="nv">$1</span><span class="k">))</span>
<span class="o">}</span>

<span class="c1"># octal to decimal </span>
<span class="k">function</span> cf_oct2Dec<span class="o">()</span> <span class="o">{</span>
  <span class="nb">echo</span> <span class="k">$((</span><span class="m">8#</span><span class="nv">$1</span><span class="k">))</span>
<span class="o">}</span>

<span class="c1"># binary to decimal </span>
<span class="k">function</span> cf_bin2Dec<span class="o">()</span> <span class="o">{</span>
  <span class="nb">echo</span> <span class="k">$((</span><span class="m">2#</span><span class="nv">$1</span><span class="k">))</span>
<span class="o">}</span>

<span class="k">function</span> cf_calc<span class="o">()</span> <span class="o">{</span>
  <span class="nb">local</span> <span class="nv">exp</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
  <span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$exp</span><span class="s2">&quot;</span> <span class="p">|</span> bc -l <span class="p">|</span> awk <span class="s1">&#39;{printf &quot;%.2f&quot;, $0}&#39;</span>
<span class="o">}</span>

<span class="c1"># warning and exit, not for interactive shell</span>
<span class="k">function</span> cf_die<span class="o">()</span> <span class="o">{</span>
  <span class="nb">local</span> <span class="nv">msg</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
  <span class="nb">local</span> <span class="nv">code</span><span class="o">=</span><span class="si">${</span><span class="nv">2</span><span class="k">:-</span><span class="nv">1</span><span class="si">}</span>
  <span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$msg</span><span class="s2">&quot;</span> <span class="o">&amp;&amp;</span> <span class="nb">exit</span> <span class="nv">$code</span>
<span class="o">}</span>

<span class="c1"># highlight key words from file or pipeline</span>
<span class="k">function</span> cf_highlight<span class="o">()</span> <span class="o">{</span>
  <span class="nb">local</span> <span class="nv">keyword</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
  <span class="nb">local</span> <span class="nv">cgrep</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span>_get_colorful_grep<span class="k">)</span><span class="s2">&quot;</span>
  <span class="k">if</span> <span class="o">[</span> -p /dev/stdin <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="c1"># from pipeline</span>
    <span class="k">while</span> <span class="nv">IFS</span><span class="o">=</span><span class="s1">&#39;&#39;</span> <span class="nb">read</span> line<span class="p">;</span> <span class="k">do</span>
      <span class="nb">echo</span> <span class="nv">$line</span> <span class="p">|</span> <span class="nb">eval</span> <span class="s2">&quot;</span><span class="nv">$cgrep</span><span class="s2"> -E \&quot;</span><span class="si">${</span><span class="nv">keyword</span><span class="si">}</span><span class="s2">|</span>$<span class="s2">\&quot;&quot;</span>
    <span class="k">done</span>
  <span class="k">else</span>
    <span class="nb">local</span> <span class="nv">file</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span>
    <span class="nb">eval</span> <span class="s2">&quot;</span><span class="nv">$cgrep</span><span class="s2"> -E \&quot;</span><span class="si">${</span><span class="nv">keyword</span><span class="si">}</span><span class="s2">|</span>$<span class="s2">\&quot;&quot;</span> <span class="s2">&quot;</span><span class="nv">$file</span><span class="s2">&quot;</span>
  <span class="k">fi</span>
<span class="o">}</span>

<span class="k">function</span> cf_ps_env<span class="o">()</span> <span class="o">{</span>
  <span class="nb">local</span> <span class="nv">pid</span><span class="o">=</span><span class="nv">$1</span>
  ! cf_is_pid_exists &gt;/dev/null <span class="nv">$pid</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;pid:</span><span class="nv">$pid</span><span class="s2"> not exists&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>

  <span class="k">if</span> cf_is_linux &gt;/dev/null<span class="p">;</span> <span class="k">then</span>
    xargs --null --max-args<span class="o">=</span><span class="m">1</span> &lt; /proc/<span class="nv">$pid</span>/environ
  <span class="k">elif</span> cf_is_darwin &gt;/dev/null<span class="p">;</span> <span class="k">then</span>
    ps -wwE -p <span class="nv">$pid</span>
  <span class="k">else</span>
    <span class="nb">echo</span> <span class="s2">&quot;unsupported os&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
  <span class="k">fi</span>
<span class="o">}</span>

<span class="c1"># get bash(current shell) major version</span>
<span class="k">function</span> cf_bash_major_ver<span class="o">()</span> <span class="o">{</span>
  <span class="nb">echo</span> <span class="si">${</span><span class="nv">BASH_VERSINFO</span><span class="p">[0]</span><span class="si">}</span>
<span class="o">}</span>

<span class="c1"># get bash(current shell) minor version</span>
<span class="k">function</span> cf_bash_minor_ver<span class="o">()</span> <span class="o">{</span>
  <span class="nb">echo</span> <span class="si">${</span><span class="nv">BASH_VERSINFO</span><span class="p">[1]</span><span class="si">}</span>
<span class="o">}</span>

<span class="c1"># get kernel version</span>
<span class="k">function</span> cf_kernel_ver<span class="o">()</span> <span class="o">{</span>
  <span class="k">if</span> cf_is_linux &gt;/dev/null<span class="p">;</span> <span class="k">then</span>
    uname -r <span class="p">|</span> cut -d<span class="s1">&#39;-&#39;</span> -f1
  <span class="k">elif</span> cf_is_darwin &gt;/dev/null<span class="p">;</span> <span class="k">then</span>
    uname -r <span class="p">|</span> cut -d<span class="s1">&#39;-&#39;</span> -f1
  <span class="k">else</span>
    <span class="nb">echo</span> <span class="s2">&quot;unsupported os&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
  <span class="k">fi</span>
<span class="o">}</span>

<span class="c1"># get kernel major version</span>
<span class="k">function</span> cf_kernel_major_ver<span class="o">()</span> <span class="o">{</span>
  <span class="k">if</span> cf_is_linux &gt;/dev/null<span class="p">;</span> <span class="k">then</span>
    uname -r <span class="p">|</span> awk -F<span class="s1">&#39;.&#39;</span> <span class="s1">&#39;{print $1&quot;.&quot;$2}&#39;</span> 
  <span class="k">elif</span> cf_is_darwin &gt;/dev/null<span class="p">;</span> <span class="k">then</span>
    uname -r <span class="p">|</span> awk -F<span class="s1">&#39;.&#39;</span> <span class="s1">&#39;{print $1&quot;.&quot;$2}&#39;</span> 
  <span class="k">else</span>
    <span class="nb">echo</span> <span class="s2">&quot;unsupported os&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
  <span class="k">fi</span>
<span class="o">}</span>

<span class="c1"># get kernel minor version</span>
<span class="k">function</span> cf_kernel_minor_ver<span class="o">()</span> <span class="o">{</span>
  <span class="k">if</span> cf_is_linux &gt;/dev/null<span class="p">;</span> <span class="k">then</span>
    uname -r <span class="p">|</span> awk -F<span class="s1">&#39;.&#39;</span> <span class="s1">&#39;{print $3}&#39;</span>
  <span class="k">elif</span> cf_is_darwin &gt;/dev/null<span class="p">;</span> <span class="k">then</span>
    uname -r <span class="p">|</span> awk -F<span class="s1">&#39;.&#39;</span> <span class="s1">&#39;{print $3}&#39;</span>
  <span class="k">else</span>
    <span class="nb">echo</span> <span class="s2">&quot;unsupported os&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
  <span class="k">fi</span>
<span class="o">}</span>

<span class="c1"># get value from config file such as app.properties</span>
<span class="k">function</span> cf_get_property<span class="o">()</span> <span class="o">{</span>
  <span class="nb">local</span> <span class="nv">file</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
  <span class="nb">local</span> <span class="nv">key</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span>
  grep <span class="s2">&quot;^</span><span class="si">${</span><span class="nv">key</span><span class="si">}</span><span class="s2">=&quot;</span> <span class="s2">&quot;</span><span class="nv">$file</span><span class="s2">&quot;</span> <span class="p">|</span> tr -d <span class="s1">&#39;\r&#39;</span> <span class="p">|</span> cut -d<span class="s1">&#39;=&#39;</span> -f2 <span class="p">|</span> cf_trim
<span class="o">}</span>

<span class="c1"># get command path, eg: `cf_command_path ls` output /usr/bin/ls</span>
<span class="k">function</span> cf_command_path<span class="o">()</span> <span class="o">{</span>
  <span class="nb">local</span> <span class="nv">cmd</span><span class="o">=</span><span class="nv">$1</span>
  cf_is_bash <span class="o">&amp;&amp;</span> <span class="nb">builtin</span> <span class="nb">type</span> -P <span class="nv">$cmd</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="nv">$?</span>

  <span class="k">if</span> <span class="o">[</span> -x /usr/bin/which <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nb">local</span> <span class="nv">p</span><span class="o">=</span><span class="k">$(</span> /usr/bin/which <span class="nv">$1</span> <span class="p">|</span> head -1 <span class="k">)</span>
    <span class="o">[</span> ! -z <span class="s2">&quot;</span><span class="nv">$p</span><span class="s2">&quot;</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="nv">$p</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">0</span>
    <span class="k">return</span> <span class="m">1</span>
  <span class="k">else</span>
    <span class="nb">local</span> <span class="nv">p</span><span class="o">=</span><span class="k">$(</span> which <span class="nv">$1</span> <span class="p">|</span> grep <span class="s2">&quot;^/&quot;</span> <span class="p">|</span> head -1 <span class="k">)</span>
    <span class="o">[</span> ! -z <span class="s2">&quot;</span><span class="nv">$p</span><span class="s2">&quot;</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="nv">$p</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">0</span>
    <span class="k">return</span> <span class="m">1</span>
  <span class="k">fi</span>
<span class="o">}</span>

<span class="c1"># get all ip addresses</span>
<span class="k">function</span> cf_ip_list<span class="o">()</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">[</span> -x /sbin/ip <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nb">local</span> <span class="nv">list</span><span class="o">=</span><span class="k">$(</span>/sbin/ip -o -4 addr list <span class="p">|</span> awk <span class="s1">&#39;{print $4}&#39;</span> <span class="p">|</span> cut -d<span class="s1">&#39;/&#39;</span> -f1 <span class="p">|</span> tr <span class="s1">&#39;\n&#39;</span> <span class="s1">&#39;,&#39;</span><span class="k">)</span>
  <span class="k">else</span>
    <span class="nb">local</span> <span class="nv">list</span><span class="o">=</span><span class="k">$(</span>/sbin/ifconfig <span class="p">|</span> grep <span class="s2">&quot;inet &quot;</span> <span class="p">|</span> awk <span class="s1">&#39;{print $2}&#39;</span> <span class="p">|</span> sed <span class="s1">&#39;s/addr://&#39;</span> <span class="p">|</span> tr <span class="s1">&#39;\n&#39;</span> <span class="s1">&#39;,&#39;</span><span class="k">)</span>
  <span class="k">fi</span>
  <span class="nb">echo</span> <span class="si">${</span><span class="nv">list</span><span class="p">%,</span><span class="si">}</span>
<span class="o">}</span>

<span class="k">function</span> cf_stdio<span class="o">()</span> <span class="o">{</span>
  <span class="nb">local</span> <span class="nv">pid</span><span class="o">=</span><span class="nv">$1</span>
  /usr/sbin/lsof -a -p <span class="nv">$pid</span> -d <span class="m">0</span>,1,2
<span class="o">}</span>

<span class="k">function</span> cf_stdout<span class="o">()</span> <span class="o">{</span>
  <span class="nb">local</span> <span class="nv">pid</span><span class="o">=</span><span class="nv">$1</span>
  <span class="k">if</span> cf_is_linux &gt;/dev/null<span class="p">;</span> <span class="k">then</span>
    readlink -f /proc/<span class="nv">$pid</span>/fd/1
  <span class="k">elif</span> cf_is_darwin &gt;/dev/null<span class="p">;</span> <span class="k">then</span>
    /usr/sbin/lsof -a -p <span class="nv">$pid</span> -d <span class="m">1</span> <span class="p">|</span> awk <span class="s1">&#39;NR&gt;1{print $NF}&#39;</span>
  <span class="k">else</span>
    <span class="nb">echo</span> <span class="s2">&quot;unsupported os&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
  <span class="k">fi</span>
<span class="o">}</span>

<span class="c1"># get file last modification time</span>
<span class="k">function</span> cf_last_modification<span class="o">()</span> <span class="o">{</span>
  <span class="nb">local</span> <span class="nv">file</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
  <span class="k">if</span> <span class="o">[[</span> <span class="nv">$OSTYPE</span> <span class="o">==</span> *linux* <span class="o">]]</span><span class="p">;</span><span class="k">then</span>
    date +%Y%m%d%H%M%S -r <span class="nv">$file</span>
  <span class="k">elif</span> <span class="o">[[</span> <span class="nv">$OSTYPE</span> <span class="o">==</span> *darwin* <span class="o">]]</span><span class="p">;</span><span class="k">then</span>
    stat -f <span class="s2">&quot;%Sm&quot;</span> -t <span class="s2">&quot;%Y%m%d%H%M%S&quot;</span> <span class="nv">$file</span>
  <span class="k">fi</span>
<span class="o">}</span>

<span class="c1"># check current user is root </span>
<span class="k">function</span> cf_is_root<span class="o">()</span> <span class="o">{</span>
  <span class="o">[</span> <span class="sb">`</span>whoami<span class="sb">`</span> <span class="o">=</span> <span class="s2">&quot;root&quot;</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;true&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">0</span>
  <span class="nb">echo</span> <span class="s2">&quot;false&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
<span class="o">}</span>

<span class="c1"># check current shell is interactive</span>
<span class="k">function</span> cf_is_interactive_shell<span class="o">()</span> <span class="o">{</span>
  <span class="k">if</span> cf_is_bash &gt;/dev/null<span class="p">;</span> <span class="k">then</span>
    <span class="o">[[</span> <span class="s2">&quot;</span><span class="nv">$-</span><span class="s2">&quot;</span> <span class="o">=</span> *i* <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;true&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">0</span>
  <span class="k">elif</span> cf_is_zsh &gt;/dev/null<span class="p">;</span> <span class="k">then</span>
    <span class="o">[[</span> -o interactive <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;true&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">0</span>
  <span class="k">else</span>
    <span class="nb">echo</span> <span class="s2">&quot;unsupported shell&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
  <span class="k">fi</span>
  <span class="nb">echo</span> <span class="s2">&quot;false&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
<span class="o">}</span>

<span class="c1"># check current shell is login shell</span>
<span class="k">function</span> cf_is_login_shell<span class="o">()</span> <span class="o">{</span>
  <span class="k">if</span> cf_is_bash &gt;/dev/null<span class="p">;</span> <span class="k">then</span>
    <span class="nb">shopt</span> -q login_shell <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;true&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">0</span>
  <span class="k">elif</span> cf_is_zsh &gt;/dev/null<span class="p">;</span> <span class="k">then</span>
    <span class="o">[[</span> -o login <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;true&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">0</span>
  <span class="k">else</span>
    <span class="nb">echo</span> <span class="s2">&quot;unsupported shell&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
  <span class="k">fi</span>
  <span class="nb">echo</span> <span class="s2">&quot;false&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
<span class="o">}</span>

<span class="c1"># check command is exists</span>
<span class="k">function</span> cf_is_command_exists<span class="o">()</span> <span class="o">{</span>
  <span class="nb">local</span> <span class="nv">cmd</span><span class="o">=</span><span class="nv">$1</span>
  <span class="k">if</span> <span class="o">[</span> -x /usr/bin/which <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    /usr/bin/which <span class="nv">$cmd</span> &gt;/dev/null <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;true&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">0</span>
  <span class="k">else</span>
    which <span class="nv">$cmd</span> &gt;/dev/null <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;true&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">0</span> 
  <span class="k">fi</span>
  <span class="nb">echo</span> <span class="s2">&quot;false&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
<span class="o">}</span>

<span class="c1"># check file name globbing flag</span>
<span class="k">function</span> cf_is_glob_enabled<span class="o">()</span> <span class="o">{</span>
  <span class="k">if</span> cf_is_bash &gt;/dev/null<span class="p">;</span> <span class="k">then</span> 
    <span class="o">[[</span> <span class="nv">$-</span> !<span class="o">=</span> *f* <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;true&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">0</span>
  <span class="k">elif</span> cf_is_zsh &gt;/dev/null<span class="p">;</span> <span class="k">then</span>
    <span class="o">[[</span> -o glob <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;true&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">0</span>
  <span class="k">else</span>
    <span class="nb">echo</span> <span class="s2">&quot;unsupported shell&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
  <span class="k">fi</span>
  <span class="nb">echo</span> <span class="s2">&quot;false&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
<span class="o">}</span>

<span class="c1"># enable file name globbing</span>
<span class="k">function</span> cf_enable_glob<span class="o">()</span> <span class="o">{</span>
  cf_is_bash &gt;/dev/null <span class="o">&amp;&amp;</span> <span class="nb">set</span> +f <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">0</span>
  cf_is_zsh &gt;/dev/null <span class="o">&amp;&amp;</span> <span class="nb">set</span> -o glob <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">0</span>
  <span class="nb">echo</span> <span class="s2">&quot;unsupported shell&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
<span class="o">}</span>

<span class="c1"># disable file name globbing</span>
<span class="k">function</span> cf_disable_glob<span class="o">()</span> <span class="o">{</span>
  cf_is_bash &gt;/dev/null <span class="o">&amp;&amp;</span> <span class="nb">set</span> -f <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">0</span>
  cf_is_zsh &gt;/dev/null <span class="o">&amp;&amp;</span> <span class="nb">set</span> -o noglob <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">0</span>
  <span class="nb">echo</span> <span class="s2">&quot;unsupported shell&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
<span class="o">}</span>

<span class="c1"># check extglob flag</span>
<span class="k">function</span> cf_is_extglob_enabled<span class="o">()</span> <span class="o">{</span>
  <span class="k">if</span> cf_is_bash &gt;/dev/null<span class="p">;</span> <span class="k">then</span> 
    <span class="nb">shopt</span> -q extglob <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;true&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">0</span>
  <span class="k">elif</span> cf_is_zsh &gt;/dev/null<span class="p">;</span> <span class="k">then</span>
    <span class="o">[[</span> -o kshglob <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;true&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">0</span>
  <span class="k">else</span>
    <span class="nb">echo</span> <span class="s2">&quot;unsupported shell&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
  <span class="k">fi</span>
  <span class="nb">echo</span> <span class="s2">&quot;false&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
<span class="o">}</span>

<span class="c1"># enable extglob </span>
<span class="k">function</span> cf_enable_extglob<span class="o">()</span> <span class="o">{</span>
  cf_is_bash &gt;/dev/null <span class="o">&amp;&amp;</span> <span class="nb">shopt</span> -s extglob <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">0</span>
  cf_is_zsh &gt;/dev/null <span class="o">&amp;&amp;</span> <span class="nb">set</span> -o kshglob <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">0</span>
  <span class="nb">echo</span> <span class="s2">&quot;unsupported shell&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
<span class="o">}</span>

<span class="c1"># disable extglob </span>
<span class="k">function</span> cf_disable_extglob<span class="o">()</span> <span class="o">{</span>
  cf_is_bash &gt;/dev/null <span class="o">&amp;&amp;</span> <span class="nb">shopt</span> -u extglob <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">0</span>
  cf_is_zsh &gt;/dev/null <span class="o">&amp;&amp;</span> unsetopt kshglob <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">0</span>
  <span class="nb">echo</span> <span class="s2">&quot;unsupported shell&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
<span class="o">}</span>

<span class="c1"># check pid is exists</span>
<span class="k">function</span> cf_is_pid_exists<span class="o">()</span> <span class="o">{</span>
  <span class="nb">local</span> <span class="nv">pid</span><span class="o">=</span><span class="nv">$1</span>
  <span class="o">[</span> -z <span class="s2">&quot;</span><span class="nv">$pid</span><span class="s2">&quot;</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;false&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
  <span class="nb">kill</span> -0 <span class="nv">$pid</span> &gt;/dev/null <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;true&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">0</span>
  <span class="nb">echo</span> <span class="s2">&quot;false&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
<span class="o">}</span>

<span class="k">function</span> cf_is_java<span class="o">()</span> <span class="o">{</span>
  <span class="nb">local</span> <span class="nv">pid</span><span class="o">=</span><span class="nv">$1</span>
  ! cf_is_pid_exists &gt;/dev/null <span class="nv">$pid</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;pid:</span><span class="nv">$pid</span><span class="s2"> not exists&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
  ps -ocommand<span class="o">=</span> -p<span class="nv">$pid</span> <span class="p">|</span> awk <span class="s1">&#39;$1~/java$/&#39;</span> &gt; /dev/null <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;true&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">0</span>
  <span class="nb">echo</span> <span class="s2">&quot;false&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
<span class="o">}</span>

<span class="k">function</span> cf_is_available_port<span class="o">()</span> <span class="o">{</span>
  <span class="nb">local</span> <span class="nv">port</span><span class="o">=</span><span class="nv">$1</span>
  <span class="k">if</span> <span class="o">[[</span> <span class="s2">&quot;</span><span class="nv">$OSTYPE</span><span class="s2">&quot;</span> <span class="o">=</span> *linux* <span class="o">]]</span><span class="p">;</span><span class="k">then</span>
    <span class="nb">local</span> <span class="nv">r</span><span class="o">=</span><span class="k">$(</span> netstat -ant <span class="p">|</span> awk <span class="s1">&#39;$6==&quot;LISTEN&quot; &amp;&amp; $4~&quot;:&#39;</span><span class="nv">$port</span><span class="s1">&#39;$&quot;&#39;</span> <span class="k">)</span>
  <span class="k">elif</span> <span class="o">[[</span> <span class="s2">&quot;</span><span class="nv">$OSTYPE</span><span class="s2">&quot;</span> <span class="o">=</span> *darwin* <span class="o">]]</span><span class="p">;</span><span class="k">then</span>
    <span class="nb">local</span> <span class="nv">r</span><span class="o">=</span><span class="k">$(</span> netstat -ant <span class="p">|</span> awk <span class="s1">&#39;$6==&quot;LISTEN&quot;&#39;</span> <span class="p">|</span> grep <span class="s2">&quot;\.</span><span class="nv">$port</span><span class="s2"> &quot;</span> <span class="k">)</span>
  <span class="k">else</span>
    <span class="nb">echo</span> <span class="s2">&quot;unknown system&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
  <span class="k">fi</span>

  <span class="o">[</span> -z <span class="s2">&quot;</span><span class="nv">$r</span><span class="s2">&quot;</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;true&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">0</span><span class="p">;</span>
  <span class="nb">echo</span> <span class="s2">&quot;false&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span> <span class="c1"># port has been used</span>
<span class="o">}</span>

<span class="k">function</span> cf_defined<span class="o">()</span> <span class="o">{</span>
  <span class="k">if</span> cf_is_bash &gt;/dev/null<span class="p">;</span> <span class="k">then</span>
    <span class="o">[[</span> <span class="si">${</span><span class="p">!1-X</span><span class="si">}</span> <span class="o">==</span> <span class="si">${</span><span class="p">!1-Y</span><span class="si">}</span> <span class="o">]]</span>
  <span class="k">elif</span> cf_is_zsh &gt;/dev/null<span class="p">;</span> <span class="k">then</span>
    <span class="o">[[</span> <span class="si">${</span><span class="p">(P)1-X</span><span class="si">}</span> <span class="o">==</span> <span class="si">${</span><span class="p">(P)1-Y</span><span class="si">}</span> <span class="o">]]</span>
  <span class="k">else</span>
    <span class="nb">echo</span> <span class="s2">&quot;unsupported shell&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
  <span class="k">fi</span>
<span class="o">}</span>

<span class="k">function</span> cf_has_value<span class="o">()</span> <span class="o">{</span>
    cf_defined <span class="nv">$1</span> <span class="o">||</span> <span class="k">return</span> <span class="m">1</span>
    <span class="k">if</span> cf_is_bash &gt;/dev/null<span class="p">;</span> <span class="k">then</span>
      <span class="o">[[</span> -n <span class="si">${</span><span class="p">!1</span><span class="si">}</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">0</span>
    <span class="k">elif</span> cf_is_zsh &gt;/dev/null<span class="p">;</span> <span class="k">then</span>
      <span class="o">[[</span> -n <span class="si">${</span><span class="p">(P)1</span><span class="si">}</span> <span class="o">]]</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">0</span>
    <span class="k">fi</span>
    <span class="k">return</span> <span class="m">1</span>
<span class="o">}</span>

<span class="k">function</span> cf_has_sudo_privilege<span class="o">()</span> <span class="o">{</span>
  <span class="c1"># do not need password</span>
  sudo -n <span class="nb">echo</span> &gt;/dev/null <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span>
<span class="o">}</span>

<span class="k">function</span> cf_timestamp<span class="o">()</span> <span class="o">{</span>
  date +%F-%T <span class="p">|</span> tr <span class="s1">&#39;:-&#39;</span> <span class="s1">&#39;_&#39;</span> <span class="c1">#2015_12_01_22_15_22</span>
<span class="o">}</span>

<span class="k">function</span> cf_length<span class="o">()</span> <span class="o">{</span>
  <span class="nb">echo</span> <span class="si">${#</span><span class="nv">1</span><span class="si">}</span>
<span class="o">}</span>

<span class="c1"># trim string</span>
<span class="k">function</span> cf_trim<span class="o">()</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">[</span> -p /dev/stdin <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="k">while</span> <span class="nv">IFS</span><span class="o">=</span><span class="s1">&#39;&#39;</span> <span class="nb">read</span> line<span class="p">;</span> <span class="k">do</span>
      _trim <span class="s2">&quot;</span><span class="nv">$line</span><span class="s2">&quot;</span>
    <span class="k">done</span>
  <span class="k">else</span>
    _trim <span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
  <span class="k">fi</span>
<span class="o">}</span>

<span class="c1"># private function</span>
<span class="k">function</span> _trim<span class="o">()</span> <span class="o">{</span>
  <span class="nb">local</span> <span class="nv">str</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
  <span class="nb">local</span> <span class="nv">extglob</span><span class="o">=</span><span class="k">$(</span>cf_is_extglob_enabled<span class="k">)</span>
  <span class="k">if</span> cf_is_bash &gt;/dev/null <span class="o">||</span> cf_is_zsh &gt;/dev/null<span class="p">;</span> <span class="k">then</span>
    <span class="o">[</span> <span class="nv">$extglob</span> <span class="o">=</span> <span class="s2">&quot;false&quot;</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> cf_enable_extglob
    <span class="nv">str</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">str</span><span class="p">##*( )</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="nv">str</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">str</span><span class="p">%%*( )</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="o">[</span> <span class="nv">$extglob</span> <span class="o">=</span> <span class="s2">&quot;false&quot;</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> cf_disable_extglob
  <span class="k">else</span>
    <span class="nb">echo</span> <span class="s2">&quot;unsupported shell&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
  <span class="k">fi</span>
  <span class="nb">echo</span> <span class="nv">$str</span>
<span class="o">}</span>

<span class="k">function</span> cf_lower<span class="o">()</span> <span class="o">{</span>
  <span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span> <span class="p">|</span> tr <span class="s1">&#39;[:upper:]&#39;</span> <span class="s1">&#39;[:lower:]&#39;</span>
<span class="o">}</span>

<span class="k">function</span> cf_upper<span class="o">()</span> <span class="o">{</span>
  <span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span> <span class="p">|</span> tr <span class="s1">&#39;[:lower:]&#39;</span> <span class="s1">&#39;[:upper:]&#39;</span>
<span class="o">}</span>

<span class="k">function</span> cf_ps_name<span class="o">()</span> <span class="o">{</span>
  <span class="nb">local</span> <span class="nv">pid</span><span class="o">=</span><span class="nv">$1</span>
  ! cf_is_pid_exists &gt;/dev/null <span class="nv">$pid</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;pid:</span><span class="nv">$pid</span><span class="s2"> not exists&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
  <span class="k">if</span> cf_is_java <span class="nv">$pid</span> &gt;/dev/null<span class="p">;</span> <span class="k">then</span>
    <span class="nb">local</span> <span class="nv">main</span><span class="o">=</span><span class="k">$(</span>cf_ps_java_main <span class="nv">$pid</span><span class="k">)</span>
    <span class="nb">echo</span> <span class="s2">&quot;java(</span><span class="nv">$main</span><span class="s2">)&quot;</span>
  <span class="k">else</span>
    ps -ocommand<span class="o">=</span> -p <span class="nv">$pid</span> <span class="p">|</span> awk <span class="s1">&#39;{print $1}&#39;</span>
  <span class="k">fi</span>
<span class="o">}</span>

<span class="k">function</span> cf_ppid<span class="o">()</span> <span class="o">{</span>
  <span class="nb">local</span> <span class="nv">pid</span><span class="o">=</span><span class="nv">$1</span>
  ! cf_is_pid_exists &gt;/dev/null <span class="nv">$pid</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;pid:</span><span class="nv">$pid</span><span class="s2"> not exists&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
  ps -oppid<span class="o">=</span> -p <span class="nv">$pid</span>
<span class="o">}</span>

<span class="k">function</span> cf_ps_java_main<span class="o">()</span> <span class="o">{</span>
  <span class="nb">local</span> <span class="nv">pid</span><span class="o">=</span><span class="nv">$1</span>
  ! cf_is_pid_exists &gt;/dev/null <span class="nv">$pid</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;pid:</span><span class="nv">$pid</span><span class="s2"> not exists&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
  ps -ocommand<span class="o">=</span> -p <span class="nv">$pid</span> <span class="p">|</span> tr <span class="s1">&#39; &#39;</span> <span class="s1">&#39;\n&#39;</span> <span class="p">|</span> awk <span class="s1">&#39;/-classpath|-cp/{getline;next};/^-/{next}1&#39;</span> <span class="p">|</span> awk <span class="s1">&#39;NR==2&#39;</span>
<span class="o">}</span>

<span class="k">function</span> cf_ps_time<span class="o">()</span> <span class="o">{</span>
  <span class="nb">local</span> <span class="nv">pid</span><span class="o">=</span><span class="nv">$1</span>
  ! cf_is_pid_exists &gt;/dev/null <span class="nv">$pid</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;pid:</span><span class="nv">$pid</span><span class="s2"> not exists&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>

  <span class="nb">local</span> <span class="nv">elapsed</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span>ps -oetime<span class="o">=</span> -p <span class="nv">$pid</span> <span class="p">|</span> cf_trim<span class="k">)</span><span class="s2">&quot;</span>
  <span class="nb">local</span> <span class="nv">started</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span>ps -olstart<span class="o">=</span> -p <span class="nv">$pid</span> <span class="p">|</span> cf_trim<span class="k">)</span><span class="s2">&quot;</span>
  <span class="k">if</span> <span class="o">[</span> <span class="sb">`</span>cf_is_gnu_date<span class="sb">`</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="nv">started</span><span class="o">=</span><span class="k">$(</span>date +<span class="s1">&#39;%Y-%m-%d %H:%M:%S&#39;</span> -d <span class="s2">&quot;</span><span class="nv">$started</span><span class="s2">&quot;</span><span class="k">)</span>
  <span class="k">fi</span>
  <span class="nb">local</span> <span class="nv">cpu_time</span><span class="o">=</span><span class="k">$(</span>ps -otime<span class="o">=</span> -p <span class="nv">$pid</span> <span class="p">|</span> cf_trim<span class="k">)</span>
  <span class="nb">echo</span> <span class="s2">&quot;started from: </span><span class="nv">$started</span><span class="s2">, elapsed: </span><span class="nv">$elapsed</span><span class="s2">, cumulative cpu time: </span><span class="nv">$cpu_time</span><span class="s2">&quot;</span>
<span class="o">}</span>

<span class="k">function</span> cf_ps_zombies<span class="o">()</span> <span class="o">{</span>
  ps -opid,state,command -e <span class="p">|</span> awk <span class="s1">&#39;NR==1 || $2==&quot;Z&quot;&#39;</span>
<span class="o">}</span>

<span class="k">function</span> cf_connection_topology<span class="o">()</span> <span class="o">{</span>
  <span class="nb">local</span> <span class="nv">pid</span><span class="o">=</span><span class="nv">$1</span>
  ! cf_is_pid_exists &gt;/dev/null <span class="nv">$pid</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;pid:</span><span class="nv">$pid</span><span class="s2"> not exists&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>

  /usr/sbin/lsof -Pan -iTCP -p <span class="nv">$pid</span> &gt; /tmp/.<span class="nv">$pid</span>.lsof
  grep -o <span class="s2">&quot;[0-9.:]*-&gt;[0-9.:]*&quot;</span> /tmp/.<span class="nv">$pid</span>.lsof &gt; /tmp/.<span class="nv">$pid</span>.conns
  grep <span class="s2">&quot;LISTEN&quot;</span> /tmp/.<span class="nv">$pid</span>.lsof <span class="p">|</span> awk <span class="s1">&#39;$9~/*/{print substr($9,3)}&#39;</span> &gt; /tmp/.<span class="nv">$pid</span>.ports

  <span class="nb">echo</span> <span class="s2">&quot;-------------- downstream -------------&quot;</span>
  <span class="k">for</span> port in <span class="k">$(</span>cat /tmp/.<span class="nv">$pid</span>.ports<span class="k">)</span><span class="p">;</span> <span class="k">do</span>
    cf_connection_list_by_port <span class="nv">$port</span> <span class="p">|</span> awk <span class="s1">&#39;$6==&quot;ESTABLISHED&quot; {print $5}&#39;</span> <span class="p">|</span> cut -d<span class="s1">&#39;:&#39;</span> -f1 <span class="p">|</span> sort <span class="p">|</span> uniq -c <span class="p">|</span> awk <span class="s1">&#39;{print $2&quot;--&gt;localhost:&quot;&#39;</span><span class="nv">$port</span><span class="s1">&#39;&quot; (&quot;$1&quot;)&quot;}&#39;</span>
  <span class="k">done</span>

  <span class="nb">echo</span> <span class="s2">&quot;-------------- upstream ---------------&quot;</span>
  <span class="nb">local</span> <span class="nv">portsExpr</span><span class="o">=</span><span class="k">$(</span>cat /tmp/.<span class="nv">$pid</span>.ports <span class="p">|</span> sed -e <span class="s1">&#39;s/^/:/&#39;</span> -e <span class="s1">&#39;s/$/-&gt;/&#39;</span> <span class="p">|</span> xargs <span class="p">|</span> sed <span class="s1">&#39;s/ /|/g&#39;</span><span class="k">)</span>
  grep -Ev <span class="s2">&quot;</span><span class="nv">$portsExpr</span><span class="s2">&quot;</span> /tmp/.<span class="nv">$pid</span>.conns &gt; /tmp/.<span class="nv">$pid</span>.out
  awk -F<span class="s1">&#39;-&gt;&#39;</span> <span class="s1">&#39;{print $2}&#39;</span> /tmp/.<span class="nv">$pid</span>.out <span class="p">|</span> sort <span class="p">|</span> uniq -c <span class="p">|</span> sort -nrk1 <span class="p">|</span> awk <span class="s1">&#39;{print &quot;localhost--&gt;&quot;$2&quot; (&quot;$1&quot;)&quot;}&#39;</span>
  rm -f /tmp/.<span class="nv">$pid</span>.lsof /tmp/.<span class="nv">$pid</span>.conns /tmp/.<span class="nv">$pid</span>.ports
<span class="o">}</span>

<span class="k">function</span> cf_connection_list_by_pid<span class="o">()</span> <span class="o">{</span>
  <span class="nb">local</span> <span class="nv">pid</span><span class="o">=</span><span class="nv">$1</span>
  ! cf_is_pid_exists &gt;/dev/null <span class="nv">$pid</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;pid:</span><span class="nv">$pid</span><span class="s2"> not exists&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
  /usr/sbin/lsof -Pan -iTCP -p <span class="nv">$pid</span>
<span class="o">}</span>

<span class="k">function</span> cf_connection_list_by_port<span class="o">()</span> <span class="o">{</span>
  <span class="nb">local</span> <span class="nv">port</span><span class="o">=</span><span class="nv">$1</span>
  netstat -ant<span class="p">|</span> awk <span class="s1">&#39;$4~/[:.]&#39;</span><span class="s2">&quot;</span><span class="nv">$port</span><span class="s2">&quot;</span><span class="s1">&#39;$/&#39;</span>
<span class="o">}</span>

<span class="k">function</span> cf_connection_stat_by_pid<span class="o">()</span> <span class="o">{</span>
  <span class="nb">local</span> <span class="nv">pid</span><span class="o">=</span><span class="nv">$1</span>
  ! cf_is_pid_exists &gt;/dev/null <span class="nv">$pid</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;pid:</span><span class="nv">$pid</span><span class="s2"> not exists&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
  <span class="nb">local</span> <span class="nv">interval</span><span class="o">=</span><span class="si">${</span><span class="nv">2</span><span class="k">:-</span><span class="nv">1</span><span class="si">}</span>
  /usr/sbin/lsof -Pan -iTCP -p <span class="nv">$pid</span> -r <span class="nv">$interval</span>
<span class="o">}</span>

<span class="k">function</span> cf_connection_stat_by_port<span class="o">()</span> <span class="o">{</span>
  <span class="nb">local</span> <span class="nv">port</span><span class="o">=</span><span class="nv">$1</span>
  netstat -ant -c<span class="p">|</span> awk <span class="s1">&#39;$1==&quot;Proto&quot;{print &quot;\n&quot;$0};$4~/[:.]&#39;</span><span class="s2">&quot;</span><span class="nv">$port</span><span class="s2">&quot;</span><span class="s1">&#39;$/&#39;</span>
<span class="o">}</span>

<span class="k">function</span> cf_listening_sockets<span class="o">()</span> <span class="o">{</span>
  <span class="c1">#lsof -Pnl -i4TCP -sTCP:LISTEN #low version unsupported -sTCP params</span>
  <span class="k">if</span> cf_is_linux &gt;/dev/null <span class="o">||</span> cf_is_darwin &gt;/dev/null<span class="p">;</span> <span class="k">then</span>
    <span class="k">if</span> cf_has_sudo_privilege<span class="p">;</span> <span class="k">then</span>
      sudo /usr/sbin/lsof -Pnl -i4TCP <span class="p">|</span> grep LISTEN
    <span class="k">else</span>
      /usr/sbin/lsof -Pnl -i4TCP <span class="p">|</span> grep LISTEN
    <span class="k">fi</span>
  <span class="k">else</span>
    netstat -plnt <span class="m">2</span>&gt;/dev/null <span class="p">|</span> grep -v tcp6
  <span class="k">fi</span>
<span class="o">}</span>

<span class="k">function</span> cf_traffic_by_eth<span class="o">()</span> <span class="o">{</span>
  <span class="nb">local</span> <span class="nv">eth</span><span class="o">=</span><span class="si">${</span><span class="nv">1</span><span class="k">:-</span><span class="s2">&quot;eth0&quot;</span><span class="si">}</span>
  <span class="k">if</span> cf_is_linux &gt;/dev/null<span class="p">;</span> <span class="k">then</span>
    <span class="o">[</span> ! -d /sys/class/net/<span class="nv">$eth</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;network interface not exists.&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
    <span class="k">while</span> true<span class="p">;</span> <span class="k">do</span>
      <span class="nb">local</span> <span class="nv">r1</span><span class="o">=</span><span class="sb">`</span>cat /sys/class/net/<span class="nv">$eth</span>/statistics/rx_bytes<span class="sb">`</span>
      <span class="nb">local</span> <span class="nv">t1</span><span class="o">=</span><span class="sb">`</span>cat /sys/class/net/<span class="nv">$eth</span>/statistics/tx_bytes<span class="sb">`</span>
      sleep <span class="m">1</span>
      <span class="nb">local</span> <span class="nv">r2</span><span class="o">=</span><span class="sb">`</span>cat /sys/class/net/<span class="nv">$eth</span>/statistics/rx_bytes<span class="sb">`</span>
      <span class="nb">local</span> <span class="nv">t2</span><span class="o">=</span><span class="sb">`</span>cat /sys/class/net/<span class="nv">$eth</span>/statistics/tx_bytes<span class="sb">`</span>
      <span class="nb">local</span> <span class="nv">rkbps</span><span class="o">=</span><span class="sb">`</span>cf_calc <span class="s2">&quot;( </span><span class="nv">$r2</span><span class="s2"> - </span><span class="nv">$r1</span><span class="s2"> ) / 1024&quot;</span><span class="sb">`</span>
      <span class="nb">local</span> <span class="nv">tkbps</span><span class="o">=</span><span class="sb">`</span>cf_calc <span class="s2">&quot;( </span><span class="nv">$t2</span><span class="s2"> - </span><span class="nv">$t1</span><span class="s2"> ) / 1024&quot;</span><span class="sb">`</span>
      <span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$eth</span><span class="s2">: RX </span><span class="nv">$rkbps</span><span class="s2"> kB/s TX </span><span class="nv">$tkbps</span><span class="s2"> kB/s&quot;</span>
    <span class="k">done</span>
  <span class="k">elif</span> cf_is_darwin &gt;/dev/null<span class="p">;</span> <span class="k">then</span>
    <span class="c1"># `netstat -I eth0 -w 1` or `nettop -n -m tcp`</span>
    <span class="nb">declare</span> -a tuple
    <span class="nb">local</span> <span class="nv">_i1</span><span class="o">=</span><span class="m">0</span>
    cf_is_zsh &gt;/dev/null <span class="o">&amp;&amp;</span> <span class="nv">_i1</span><span class="o">=</span><span class="m">1</span>
    <span class="nb">local</span> <span class="nv">_i2</span><span class="o">=</span><span class="m">1</span>
    cf_is_zsh &gt;/dev/null <span class="o">&amp;&amp;</span> <span class="nv">_i1</span><span class="o">=</span><span class="m">2</span>
    <span class="k">while</span> true<span class="p">;</span> <span class="k">do</span>
      <span class="nv">tuple</span><span class="o">=(</span> <span class="k">$(</span>netstat -nbi -I <span class="nv">$eth</span> <span class="p">|</span> tail -1 <span class="p">|</span> awk <span class="s1">&#39;{print $7,$10}&#39;</span><span class="k">)</span> <span class="o">)</span>
      <span class="nb">local</span> <span class="nv">r1</span><span class="o">=</span><span class="si">${</span><span class="nv">tuple</span><span class="p">[</span><span class="nv">$_i1</span><span class="p">]</span><span class="si">}</span>
      <span class="nb">local</span> <span class="nv">t1</span><span class="o">=</span><span class="si">${</span><span class="nv">tuple</span><span class="p">[</span><span class="nv">$_i2</span><span class="p">]</span><span class="si">}</span>
      sleep <span class="m">1</span>
      <span class="nv">tuple</span><span class="o">=(</span> <span class="k">$(</span>netstat -nbi -I <span class="nv">$eth</span> <span class="p">|</span> tail -1 <span class="p">|</span> awk <span class="s1">&#39;{print $7,$10}&#39;</span><span class="k">)</span> <span class="o">)</span>
      <span class="nb">local</span> <span class="nv">r2</span><span class="o">=</span><span class="si">${</span><span class="nv">tuple</span><span class="p">[</span><span class="nv">$_i1</span><span class="p">]</span><span class="si">}</span>
      <span class="nb">local</span> <span class="nv">t2</span><span class="o">=</span><span class="si">${</span><span class="nv">tuple</span><span class="p">[</span><span class="nv">$_i2</span><span class="p">]</span><span class="si">}</span>
      <span class="nb">local</span> <span class="nv">rkbps</span><span class="o">=</span><span class="sb">`</span>cf_calc <span class="s2">&quot;( </span><span class="nv">$r2</span><span class="s2"> - </span><span class="nv">$r1</span><span class="s2"> ) / 1024&quot;</span><span class="sb">`</span>
      <span class="nb">local</span> <span class="nv">tkbps</span><span class="o">=</span><span class="sb">`</span>cf_calc <span class="s2">&quot;( </span><span class="nv">$t2</span><span class="s2"> - </span><span class="nv">$t1</span><span class="s2"> ) / 1024&quot;</span><span class="sb">`</span>
      <span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$eth</span><span class="s2">: RX </span><span class="nv">$rkbps</span><span class="s2"> kB/s TX </span><span class="nv">$tkbps</span><span class="s2"> kB/s&quot;</span>
    <span class="k">done</span>
  <span class="k">else</span>
    <span class="nb">echo</span> <span class="s2">&quot;unsupported os&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
  <span class="k">fi</span>
<span class="o">}</span>

<span class="k">function</span> cf_traffic_by_pid<span class="o">()</span> <span class="o">{</span>
  ! cf_is_linux &gt;/dev/null <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;only works in linux&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
  <span class="nb">local</span> <span class="nv">pid</span><span class="o">=</span><span class="nv">$1</span>
  ! cf_is_pid_exists &gt;/dev/null <span class="nv">$pid</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;pid:</span><span class="nv">$pid</span><span class="s2"> not exists&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>

  <span class="c1"># kernel 2.6.18 not support, must 2.6.32 or later?</span>
  <span class="nb">local</span> <span class="nv">pf</span><span class="o">=</span><span class="s2">&quot;/proc/</span><span class="nv">$pid</span><span class="s2">/net/netstat&quot;</span>
  <span class="o">[</span> ! -f <span class="nv">$pf</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$pf</span><span class="s2"> not found!&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>

  <span class="nb">declare</span> -a tuple
  <span class="nb">local</span> <span class="nv">_i1</span><span class="o">=</span><span class="m">0</span>
  cf_is_zsh &gt;/dev/null <span class="o">&amp;&amp;</span> <span class="nv">_i1</span><span class="o">=</span><span class="m">1</span>
  <span class="nb">local</span> <span class="nv">_i2</span><span class="o">=</span><span class="m">1</span>
  cf_is_zsh &gt;/dev/null <span class="o">&amp;&amp;</span> <span class="nv">_i1</span><span class="o">=</span><span class="m">2</span>
  <span class="nb">local</span> <span class="nv">pname</span><span class="o">=</span><span class="s2">&quot;</span><span class="k">$(</span>cf_ps_name <span class="nv">$pid</span><span class="k">)</span><span class="s2">&quot;</span>
  <span class="k">while</span> true<span class="p">;</span> <span class="k">do</span>
    <span class="nv">tuple</span><span class="o">=(</span> <span class="k">$(</span>grep <span class="s2">&quot;IpExt: &quot;</span> <span class="nv">$pf</span> <span class="p">|</span> awk <span class="s1">&#39;NR==2{print $8,$9}&#39;</span><span class="k">)</span> <span class="o">)</span>
    <span class="nb">local</span> <span class="nv">r1</span><span class="o">=</span><span class="si">${</span><span class="nv">tuple</span><span class="p">[</span><span class="nv">$_i1</span><span class="p">]</span><span class="si">}</span>
    <span class="nb">local</span> <span class="nv">t1</span><span class="o">=</span><span class="si">${</span><span class="nv">tuple</span><span class="p">[</span><span class="nv">$_i2</span><span class="p">]</span><span class="si">}</span>
    sleep <span class="m">1</span>
    <span class="nv">tuple</span><span class="o">=(</span> <span class="k">$(</span>grep <span class="s2">&quot;IpExt: &quot;</span> <span class="nv">$pf</span> <span class="p">|</span> awk <span class="s1">&#39;NR==2{print $8,$9}&#39;</span><span class="k">)</span> <span class="o">)</span>
    <span class="nb">local</span> <span class="nv">r2</span><span class="o">=</span><span class="si">${</span><span class="nv">tuple</span><span class="p">[</span><span class="nv">$_i1</span><span class="p">]</span><span class="si">}</span>
    <span class="nb">local</span> <span class="nv">t2</span><span class="o">=</span><span class="si">${</span><span class="nv">tuple</span><span class="p">[</span><span class="nv">$_i2</span><span class="p">]</span><span class="si">}</span>
    <span class="nb">local</span> <span class="nv">rkbps</span><span class="o">=</span><span class="sb">`</span>cf_calc <span class="s2">&quot;( </span><span class="nv">$r2</span><span class="s2"> - </span><span class="nv">$r1</span><span class="s2"> ) / 1024&quot;</span><span class="sb">`</span>
    <span class="nb">local</span> <span class="nv">tkbps</span><span class="o">=</span><span class="sb">`</span>cf_calc <span class="s2">&quot;( </span><span class="nv">$t2</span><span class="s2"> - </span><span class="nv">$t1</span><span class="s2"> ) / 1024&quot;</span><span class="sb">`</span>
    <span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$pname</span><span class="s2">: IN </span><span class="nv">$rkbps</span><span class="s2"> kB/s OUT </span><span class="nv">$tkbps</span><span class="s2"> kB/s&quot;</span>
  <span class="k">done</span>
<span class="o">}</span>

<span class="k">function</span> cf_iotop<span class="o">()</span> <span class="o">{</span>
  sudo iotop -bod1
<span class="o">}</span>

<span class="k">function</span> cf_check_sum<span class="o">()</span> <span class="o">{</span>
  <span class="nb">local</span> <span class="nv">dir</span><span class="o">=</span><span class="si">${</span><span class="nv">1</span><span class="k">:-</span><span class="nv">$PWD</span><span class="si">}</span>
  <span class="nb">local</span> <span class="nv">dirsum</span><span class="o">=</span><span class="m">0</span>
  <span class="k">for</span> sum  in <span class="k">$(</span>find <span class="si">${</span><span class="nv">dir</span><span class="si">}</span> -type f -print0 <span class="p">|</span> xargs -0 cksum <span class="p">|</span> awk <span class="s1">&#39;{print $1}&#39;</span><span class="k">)</span>
  <span class="k">do</span>
    <span class="nv">dirsum</span><span class="o">=</span><span class="k">$((</span> <span class="si">${</span><span class="nv">sum</span><span class="si">}</span> <span class="o">+</span> <span class="si">${</span><span class="nv">dirsum</span><span class="si">}</span> <span class="k">))</span>
  <span class="k">done</span>
  <span class="nb">echo</span> <span class="si">${</span><span class="nv">dirsum</span><span class="si">}</span>
<span class="o">}</span>

<span class="k">function</span> cf_java_classpath_check<span class="o">()</span> <span class="o">{</span>
  <span class="o">[</span> <span class="nv">$#</span> -eq <span class="m">0</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;please enter classpath dir&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
  <span class="o">[</span> ! -d <span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;not a directory&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>

  <span class="nb">local</span> <span class="nv">tmpfile</span><span class="o">=</span><span class="s2">&quot;/tmp/.cp</span><span class="k">$(</span>date +%s<span class="k">)</span><span class="s2">&quot;</span>
  <span class="nb">local</span> <span class="nv">tmphash</span><span class="o">=</span><span class="s2">&quot;/tmp/.hash</span><span class="k">$(</span>date +%s<span class="k">)</span><span class="s2">&quot;</span>
  <span class="nb">local</span> <span class="nv">verbose</span><span class="o">=</span><span class="s2">&quot;/tmp/cp-verbose.log&quot;</span>

  <span class="k">if</span> cf_is_zsh &gt;/dev/null<span class="p">;</span><span class="k">then</span>
    <span class="nb">local</span> -a files
    <span class="nb">local</span> <span class="nv">begin</span><span class="o">=</span><span class="m">1</span>
  <span class="k">elif</span> cf_is_bash &gt;/dev/null<span class="p">;</span><span class="k">then</span>
    <span class="nb">declare</span> -a files
    <span class="nb">local</span> <span class="nv">begin</span><span class="o">=</span><span class="m">0</span>
  <span class="k">else</span> 
    <span class="nb">echo</span> <span class="s2">&quot;unsupported shell&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
  <span class="k">fi</span>
  <span class="nv">files</span><span class="o">=(</span><span class="sb">`</span>find <span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span> -name <span class="s2">&quot;*.jar&quot;</span><span class="sb">`</span><span class="o">)</span>

  <span class="k">for</span> f in <span class="nv">$files</span><span class="p">;</span> <span class="k">do</span>
    <span class="nv">jarName</span><span class="o">=</span><span class="sb">`</span>basename <span class="nv">$f</span><span class="sb">`</span>
    <span class="nv">list</span><span class="o">=</span><span class="sb">`</span>unzip -l <span class="nv">$f</span> <span class="p">|</span> awk -v <span class="nv">fn</span><span class="o">=</span><span class="nv">$jarName</span> <span class="s1">&#39;/\.class$/{print $NF,fn}&#39;</span><span class="sb">`</span>
    <span class="nv">size</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$list</span><span class="s2">&quot;</span> <span class="p">|</span> wc -l<span class="sb">`</span>
    <span class="nb">echo</span> <span class="nv">$jarName</span> <span class="nv">$size</span> &gt;&gt; <span class="nv">$tmphash</span>
    <span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$list</span><span class="s2">&quot;</span>
  <span class="k">done</span> <span class="p">|</span> sort <span class="p">|</span> awk <span class="s1">&#39;NF{ a[$1]++;m[$1]=m[$1]&quot;,&quot;$2}END{for(i in a) if(a[i] &gt; 1) print i,substr(m[i],2)}&#39;</span> &gt; <span class="nv">$tmpfile</span>

  awk <span class="s1">&#39;{print $2}&#39;</span> <span class="nv">$tmpfile</span> <span class="p">|</span> awk -F<span class="s1">&#39;,&#39;</span> <span class="s1">&#39;{i=1;for(;i&lt;=NF;i++) for(j=i+1;j&lt;=NF;j++) print $i,$j}&#39;</span> <span class="p">|</span> sort <span class="p">|</span> uniq -c <span class="p">|</span> sort -nrk1 <span class="p">|</span> 
  <span class="k">while</span> <span class="nb">read</span> line<span class="p">;</span> <span class="k">do</span>
    <span class="nb">local</span> <span class="nv">dup</span><span class="o">=</span><span class="si">${</span><span class="nv">line</span><span class="p">%% *</span><span class="si">}</span>
    <span class="nb">local</span> <span class="nv">jars</span><span class="o">=</span><span class="si">${</span><span class="nv">line</span><span class="p">#* </span><span class="si">}</span>
    <span class="nb">local</span> <span class="nv">jar1</span><span class="o">=</span><span class="si">${</span><span class="nv">jars</span><span class="p">% *</span><span class="si">}</span>
    <span class="nb">local</span> <span class="nv">jar2</span><span class="o">=</span><span class="si">${</span><span class="nv">jars</span><span class="p">#* </span><span class="si">}</span>
    <span class="nb">local</span> <span class="nv">len_jar1</span><span class="o">=</span><span class="sb">`</span>grep -F <span class="s2">&quot;</span><span class="nv">$jar1</span><span class="s2">&quot;</span> <span class="nv">$tmphash</span> <span class="p">|</span> grep ^<span class="s2">&quot;</span><span class="nv">$jar1</span><span class="s2">&quot;</span> <span class="p">|</span> awk <span class="s1">&#39;{print $2}&#39;</span><span class="sb">`</span>
    <span class="nb">local</span> <span class="nv">len_jar2</span><span class="o">=</span><span class="sb">`</span>grep -F <span class="s2">&quot;</span><span class="nv">$jar2</span><span class="s2">&quot;</span> <span class="nv">$tmphash</span> <span class="p">|</span> grep ^<span class="s2">&quot;</span><span class="nv">$jar2</span><span class="s2">&quot;</span> <span class="p">|</span> awk <span class="s1">&#39;{print $2}&#39;</span><span class="sb">`</span>
    <span class="nb">local</span> <span class="nv">len</span><span class="o">=</span><span class="k">$((</span><span class="nv">$len_jar1</span> &gt; <span class="nv">$len_jar2</span> ? <span class="nv">$len_jar1</span> : <span class="nv">$len_jar2</span><span class="k">))</span>
    <span class="nb">local</span> <span class="nv">per</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="s2">&quot;scale=2; </span><span class="nv">$dup</span><span class="s2">/</span><span class="nv">$len</span><span class="s2">&quot;</span> <span class="p">|</span> bc -l<span class="k">)</span>
    <span class="nb">echo</span> <span class="si">${</span><span class="nv">per</span><span class="p">/./</span><span class="si">}</span> <span class="nv">$dup</span> <span class="nv">$jar1</span> <span class="nv">$jar2</span>
  <span class="k">done</span> <span class="p">|</span> sort -nr -k1 -k2 <span class="p">|</span> awk <span class="s1">&#39;NR==1{print &quot;Similarity DuplicateClasses File1 File2&quot;}{print &quot;%&quot;$0}&#39;</span><span class="p">|</span> column -t

  sort <span class="nv">$tmpfile</span> <span class="p">|</span> awk <span class="s1">&#39;{print $1,&quot;\n\t\t&quot;,$2}&#39;</span> &gt; <span class="nv">$verbose</span>
  <span class="nb">echo</span> <span class="s2">&quot;See </span><span class="nv">$verbose</span><span class="s2"> for more details.&quot;</span>

  rm -f <span class="nv">$tmpfile</span>
  rm -f <span class="nv">$tmphash</span>
<span class="o">}</span>

<span class="k">function</span> cf_java_class_find<span class="o">()</span> <span class="o">{</span>
  <span class="nb">local</span> <span class="nv">libdir</span><span class="o">=</span><span class="nv">$1</span>
  <span class="nb">local</span> <span class="nv">name</span><span class="o">=</span><span class="nv">$2</span>
  <span class="nb">local</span> <span class="nv">glob</span><span class="o">=</span><span class="k">$(</span>cf_is_glob_enabled<span class="k">)</span>
  <span class="o">[</span> <span class="nv">$glob</span> <span class="o">=</span> <span class="s2">&quot;false&quot;</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> cf_enable_glob
  <span class="nb">builtin</span> <span class="nb">pushd</span> <span class="nv">$libdir</span> &gt;/dev/null
  <span class="k">for</span> j in *.jar<span class="p">;</span> <span class="k">do</span>
    unzip -l <span class="nv">$j</span> <span class="p">|</span> grep <span class="nv">$name</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="nv">$j</span><span class="p">;</span>
  <span class="k">done</span>
  <span class="nb">builtin</span> <span class="nb">popd</span> &gt;/dev/null
  <span class="o">[</span> <span class="nv">$glob</span> <span class="o">=</span> <span class="s2">&quot;false&quot;</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> cf_disable_glob
<span class="o">}</span>

<span class="k">function</span> cf_java_pids<span class="o">()</span> <span class="o">{</span>
  ps x <span class="p">|</span> grep <span class="s2">&quot;jav[a]&quot;</span> <span class="p">|</span> awk <span class="s1">&#39;{print $1}&#39;</span>
<span class="o">}</span>

<span class="k">function</span> cf_java_infos<span class="o">()</span> <span class="o">{</span>
  <span class="k">for</span> p in <span class="sb">`</span>cf_java_pids<span class="sb">`</span><span class="p">;</span> <span class="k">do</span>
    <span class="nb">echo</span> <span class="s2">&quot;java pid: </span><span class="nv">$p</span><span class="s2">&quot;</span>
    <span class="nv">info</span><span class="o">=</span><span class="sb">`</span>ps -opid<span class="o">=</span>,command<span class="o">=</span> -p <span class="nv">$p</span> <span class="p">|</span> tr <span class="s1">&#39; &#39;</span> <span class="s1">&#39;\n&#39;</span> <span class="p">|</span> awk <span class="s1">&#39;/-classpath|-cp/{getline;next};/-Xmx|-Dcatalina.base/{print};/^-/{next};1&#39;</span> <span class="p">|</span> xargs<span class="sb">`</span>
    <span class="nb">echo</span> <span class="s2">&quot;  </span><span class="nv">$info</span><span class="s2">&quot;</span>
    <span class="nv">time</span><span class="o">=</span><span class="sb">`</span>cf_ps_time <span class="nv">$p</span><span class="sb">`</span>
    <span class="nb">echo</span> <span class="s2">&quot;  </span><span class="nv">$time</span><span class="s2">&quot;</span>
  <span class="k">done</span>
<span class="o">}</span>

<span class="k">function</span> cf_java_threads<span class="o">()</span> <span class="o">{</span>
  <span class="nb">local</span> <span class="nv">pid</span><span class="o">=</span><span class="nv">$1</span>
  <span class="nb">local</span> <span class="nv">vm_threads</span><span class="o">=</span><span class="s2">&quot;GC task|VM |CompilerThread|Finalizer|Reference Handler|Signal Dispatcher&quot;</span>
  <span class="s2">&quot;</span><span class="nv">$JAVA_HOME</span><span class="s2">&quot;</span>/bin/jstack <span class="nv">$pid</span> <span class="p">|</span> grep <span class="s2">&quot;^\&quot;&quot;</span> <span class="p">|</span> grep -Ev <span class="s2">&quot;</span><span class="nv">$vm_threads</span><span class="s2">&quot;</span>
<span class="o">}</span>

<span class="k">function</span> cf_java_sysprops<span class="o">()</span> <span class="o">{</span>
  <span class="nb">local</span> <span class="nv">pid</span><span class="o">=</span><span class="nv">$1</span>
  ! cf_is_pid_exists &gt;/dev/null <span class="nv">$pid</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;pid:</span><span class="nv">$pid</span><span class="s2"> not exists&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
  <span class="s2">&quot;</span><span class="nv">$JAVA_HOME</span><span class="s2">&quot;</span>/bin/jinfo -sysprops <span class="nv">$pid</span>
<span class="o">}</span>

<span class="k">function</span> cf_jstack_series<span class="o">()</span> <span class="o">{</span>
  <span class="nb">local</span> <span class="nv">pid</span><span class="o">=</span><span class="nv">$1</span>
  ! cf_is_pid_exists &gt;/dev/null <span class="nv">$pid</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;pid:</span><span class="nv">$pid</span><span class="s2"> not exists&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
  <span class="nb">local</span> <span class="nv">count</span><span class="o">=</span><span class="si">${</span><span class="nv">2</span><span class="k">:-</span><span class="nv">5</span><span class="si">}</span>  <span class="c1"># defaults 5 times</span>
  <span class="nb">local</span> <span class="nv">delay</span><span class="o">=</span><span class="si">${</span><span class="nv">3</span><span class="k">:-</span><span class="nv">0</span><span class="p">.5</span><span class="si">}</span> <span class="c1"># defaults 0.5 seconds</span>

  <span class="nb">local</span> <span class="nv">logdir</span><span class="o">=</span><span class="si">${</span><span class="nv">LOG_DIR</span><span class="k">:-</span><span class="s2">&quot;/tmp&quot;</span><span class="si">}</span>
  <span class="k">while</span> <span class="o">[</span> <span class="nv">$count</span> -gt <span class="m">0</span> <span class="o">]</span><span class="p">;</span> <span class="k">do</span>
    <span class="k">if</span> cf_is_gnu_date &gt;/dev/null<span class="p">;</span> <span class="k">then</span> 
      <span class="nb">local</span> <span class="nv">suffix</span><span class="o">=</span><span class="k">$(</span>date +%H%M%S.%N<span class="k">)</span>
    <span class="k">else</span>
      <span class="nb">local</span> <span class="nv">suffix</span><span class="o">=</span><span class="k">$(</span>date +%H%M%S<span class="k">)</span><span class="s2">&quot;.&quot;</span><span class="nv">$count</span>
    <span class="k">fi</span>
    <span class="s2">&quot;</span><span class="nv">$JAVA_HOME</span><span class="s2">&quot;</span>/bin/jstack <span class="nv">$pid</span> &gt; <span class="nv">$logdir</span>/jstack.<span class="nv">$pid</span>.<span class="nv">$suffix</span>
    sleep <span class="nv">$delay</span>
    <span class="nb">let</span> count--
    <span class="nb">echo</span> -n <span class="s2">&quot;.&quot;</span>
  <span class="k">done</span>
<span class="o">}</span>

<span class="k">function</span> cf_dmesg<span class="o">()</span> <span class="o">{</span>
  ! cf_is_linux &gt;/dev/null <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;only works in linux&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>

  dmesg -T <span class="s2">&quot;</span><span class="nv">$@</span><span class="s2">&quot;</span> <span class="m">2</span>&gt;/dev/null
  <span class="o">[</span> <span class="nv">$?</span> -eq <span class="m">0</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">0</span>

  dmesg <span class="s2">&quot;</span><span class="nv">$@</span><span class="s2">&quot;</span> <span class="p">|</span> perl -w -e <span class="s1">&#39;use strict;</span>
<span class="s1">  my ($uptime) = do { local @ARGV=&quot;/proc/uptime&quot;;&lt;&gt;}; ($uptime) = ($uptime =~ /^(\d+)\./);</span>
<span class="s1">  foreach my $line (&lt;&gt;) {</span>
<span class="s1">    printf( ($line=~/^\[\s*(\d+)\.\d+\](.+)/) ? ( &quot;[%s]%s\n&quot;, scalar localtime(time - $uptime + $1), $2 ) : $line )</span>
<span class="s1">  }&#39;</span>
<span class="o">}</span>

<span class="k">function</span> cf_trace_http_request<span class="o">()</span> <span class="o">{</span>
  ! cf_is_linux &gt;/dev/null <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;only works in linux&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
  <span class="nb">local</span> <span class="nv">pid</span><span class="o">=</span><span class="nv">$1</span>
  ! cf_is_pid_exists &gt;/dev/null <span class="nv">$pid</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;pid:</span><span class="nv">$pid</span><span class="s2"> not exists&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
  strace -e <span class="nb">read</span> -s <span class="m">2000</span> -qftp <span class="nv">$pid</span> <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="p">|</span> grep <span class="s2">&quot; HTTP/1[.][01][\]r[\]n&quot;</span> 
<span class="o">}</span>

<span class="k">function</span> cf_trace_http_response<span class="o">()</span> <span class="o">{</span>
  ! cf_is_linux &gt;/dev/null <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;only works in linux&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
  <span class="nb">local</span> <span class="nv">pid</span><span class="o">=</span><span class="nv">$1</span>
  ! cf_is_pid_exists &gt;/dev/null <span class="nv">$pid</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;pid:</span><span class="nv">$pid</span><span class="s2"> not exists&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
  strace -e write -s <span class="m">2000</span> -qftp <span class="nv">$pid</span> <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="p">|</span> grep <span class="s2">&quot;HTTP/1[.][01] &quot;</span> 
<span class="o">}</span>

<span class="k">function</span> cf_trace_http_req_header<span class="o">()</span> <span class="o">{</span>
  ! cf_is_linux &gt;/dev/null <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;only works in linux&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
  <span class="nb">local</span> <span class="nv">pid</span><span class="o">=</span><span class="nv">$1</span>
  ! cf_is_pid_exists &gt;/dev/null <span class="nv">$pid</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;pid:</span><span class="nv">$pid</span><span class="s2"> not exists&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
  strace -e <span class="nb">read</span> -s <span class="m">2000</span> -qftp <span class="nv">$pid</span> <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="p">|</span> grep <span class="s2">&quot; HTTP/1[.][01][\]r[\]n&quot;</span> <span class="p">|</span> sed  <span class="s1">&#39;s/\\r\\n/\n/g&#39;</span>
<span class="o">}</span>

<span class="k">function</span> cf_trace_http_resp_header<span class="o">()</span> <span class="o">{</span>
  ! cf_is_linux &gt;/dev/null <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;only works in linux&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
  <span class="nb">local</span> <span class="nv">pid</span><span class="o">=</span><span class="nv">$1</span>
  ! cf_is_pid_exists &gt;/dev/null <span class="nv">$pid</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;pid:</span><span class="nv">$pid</span><span class="s2"> not exists&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
  strace -e write -s <span class="m">2000</span> -qftp <span class="nv">$pid</span> <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="p">|</span> grep <span class="s2">&quot;HTTP/1[.][01] &quot;</span> <span class="p">|</span> sed <span class="s1">&#39;s/\\r\\n/\n/g&#39;</span>
<span class="o">}</span>

<span class="k">function</span> cf_trace_http_invoke<span class="o">()</span> <span class="o">{</span>
  ! cf_is_linux &gt;/dev/null <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;only works in linux&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
  <span class="nb">local</span> <span class="nv">pid</span><span class="o">=</span><span class="nv">$1</span>
  ! cf_is_pid_exists &gt;/dev/null <span class="nv">$pid</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;pid:</span><span class="nv">$pid</span><span class="s2"> not exists&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
  strace -e sendto -s <span class="m">2000</span> -qftp <span class="nv">$pid</span> <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="p">|</span> grep <span class="s2">&quot; HTTP/1[.][01][\]r[\]n&quot;</span> 
<span class="o">}</span>

<span class="k">function</span> cf_trace_connect<span class="o">()</span> <span class="o">{</span>
  ! cf_is_linux &gt;/dev/null <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;only works in linux&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
  <span class="nb">local</span> <span class="nv">pid</span><span class="o">=</span><span class="nv">$1</span>
  ! cf_is_pid_exists &gt;/dev/null <span class="nv">$pid</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;pid:</span><span class="nv">$pid</span><span class="s2"> not exists&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
  strace -e connect -s <span class="m">2000</span> -qftp <span class="nv">$pid</span> <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="p">|</span> grep <span class="s2">&quot;port&quot;</span>
<span class="o">}</span>

<span class="k">function</span> cf_trace_socket<span class="o">()</span> <span class="o">{</span>
  ! cf_is_linux &gt;/dev/null <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;only works in linux&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
  <span class="nb">local</span> <span class="nv">pid</span><span class="o">=</span><span class="nv">$1</span>
  ! cf_is_pid_exists &gt;/dev/null <span class="nv">$pid</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;pid:</span><span class="nv">$pid</span><span class="s2"> not exists&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
  strace -e connect,socket,close -s <span class="m">2000</span> -qftp <span class="nv">$pid</span> <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="p">|</span> grep <span class="s2">&quot;port&quot;</span>
<span class="o">}</span>

<span class="k">function</span> cf_trace_sql_select<span class="o">()</span> <span class="o">{</span>
  ! cf_is_linux &gt;/dev/null <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;only works in linux&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
  <span class="nb">local</span> <span class="nv">pid</span><span class="o">=</span><span class="nv">$1</span>
  ! cf_is_pid_exists &gt;/dev/null <span class="nv">$pid</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;pid:</span><span class="nv">$pid</span><span class="s2"> not exists&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
  strace -e sendto,write -s <span class="m">2000</span> -qftp <span class="nv">$pid</span> <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="p">|</span> grep -i <span class="s2">&quot;[\]3select&quot;</span>
<span class="o">}</span>

<span class="k">function</span> cf_trace_sql_update<span class="o">()</span> <span class="o">{</span>
  ! cf_is_linux &gt;/dev/null <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;only works in linux&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
  <span class="nb">local</span> <span class="nv">pid</span><span class="o">=</span><span class="nv">$1</span>
  ! cf_is_pid_exists &gt;/dev/null <span class="nv">$pid</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;pid:</span><span class="nv">$pid</span><span class="s2"> not exists&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
  strace -e sendto,write -s <span class="m">2000</span> -qftp <span class="nv">$pid</span> <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="p">|</span> grep -i <span class="s2">&quot;[\]3update&quot;</span>
<span class="o">}</span>

<span class="k">function</span> cf_trace_sql_insert<span class="o">()</span> <span class="o">{</span>
  ! cf_is_linux &gt;/dev/null <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;only works in linux&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
  <span class="nb">local</span> <span class="nv">pid</span><span class="o">=</span><span class="nv">$1</span>
  ! cf_is_pid_exists &gt;/dev/null <span class="nv">$pid</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;pid:</span><span class="nv">$pid</span><span class="s2"> not exists&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
  strace -e sendto,write -s <span class="m">2000</span> -qftp <span class="nv">$pid</span> <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="p">|</span> grep -i <span class="s2">&quot;[\]3insert&quot;</span>
<span class="o">}</span>

<span class="k">function</span> cf_trace_redis_command<span class="o">()</span> <span class="o">{</span>
  ! cf_is_linux &gt;/dev/null <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;only works in linux&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
  <span class="nb">local</span> <span class="nv">pid</span><span class="o">=</span><span class="nv">$1</span>
  ! cf_is_pid_exists &gt;/dev/null <span class="nv">$pid</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;pid:</span><span class="nv">$pid</span><span class="s2"> not exists&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
  <span class="nb">local</span> <span class="nv">cmd</span><span class="o">=</span><span class="nv">$2</span>
  strace -e sendto,write -s <span class="m">2000</span> -qftp <span class="nv">$pid</span> <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="p">|</span> grep -i <span class="s2">&quot;</span><span class="nv">$cmd</span><span class="s2">[\]r[\]n&quot;</span>
<span class="o">}</span>

<span class="k">function</span> cf_trace_dubbo_request<span class="o">()</span> <span class="o">{</span>
  ! cf_is_linux &gt;/dev/null <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;only works in linux&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
  <span class="nb">local</span> <span class="nv">pid</span><span class="o">=</span><span class="nv">$1</span>
  ! cf_is_pid_exists &gt;/dev/null <span class="nv">$pid</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;pid:</span><span class="nv">$pid</span><span class="s2"> not exists&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
  strace -e <span class="nb">read</span> -s <span class="m">2000</span> -qftp <span class="nv">$pid</span> <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="p">|</span> grep -i <span class="s2">&quot;[\]tinterface&quot;</span>
<span class="o">}</span>

<span class="k">function</span> cf_trace_dubbo_invoke<span class="o">()</span> <span class="o">{</span>
  ! cf_is_linux &gt;/dev/null <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;only works in linux&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
  <span class="nb">local</span> <span class="nv">pid</span><span class="o">=</span><span class="nv">$1</span>
  ! cf_is_pid_exists &gt;/dev/null <span class="nv">$pid</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;pid:</span><span class="nv">$pid</span><span class="s2"> not exists&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
  strace -e write -s <span class="m">2000</span> -qftp <span class="nv">$pid</span> <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="p">|</span> grep -i <span class="s2">&quot;[\]tinterface&quot;</span>
<span class="o">}</span>

<span class="k">function</span> cf_trace_system_call<span class="o">()</span> <span class="o">{</span>
  ! cf_is_linux &gt;/dev/null <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;only works in linux&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
  <span class="nb">local</span> <span class="nv">pid</span><span class="o">=</span><span class="nv">$1</span>
  ! cf_is_pid_exists &gt;/dev/null <span class="nv">$pid</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;pid:</span><span class="nv">$pid</span><span class="s2"> not exists&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
  <span class="nb">local</span> <span class="nv">time</span><span class="o">=</span><span class="si">${</span><span class="nv">2</span><span class="k">:-</span><span class="nv">5</span><span class="si">}</span>

  <span class="nb">local</span> <span class="nv">outfile</span><span class="o">=</span><span class="s2">&quot;/tmp/.sys-call.</span><span class="nv">$pid</span><span class="s2">&quot;</span>
  strace -cqftp <span class="nv">$pid</span> -o <span class="nv">$outfile</span> <span class="p">&amp;</span> 
  <span class="nb">local</span> <span class="nv">spid</span><span class="o">=</span><span class="nv">$!</span>
  <span class="k">while</span> <span class="o">[</span> <span class="nv">$time</span> -gt <span class="m">0</span> <span class="o">]</span><span class="p">;</span> <span class="k">do</span>
    sleep <span class="m">1</span>
    <span class="nb">let</span> time--
    <span class="nb">echo</span> -n <span class="s2">&quot;.&quot;</span>
  <span class="k">done</span>
  <span class="nb">echo</span> <span class="s2">&quot;&quot;</span>
  <span class="nb">kill</span> <span class="nv">$spid</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;ok&quot;</span>
  <span class="c1"># if strace process still exists</span>
  cf_is_pid_exists <span class="nv">$spid</span> &gt;/dev/null <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="o">&amp;&amp;</span> <span class="nb">kill</span> -9 <span class="nv">$spid</span>
  cat <span class="nv">$outfile</span> <span class="o">&amp;&amp;</span> rm -f <span class="nv">$outfile</span>
<span class="o">}</span>

<span class="k">function</span> cf_random_entropy_stat<span class="o">()</span> <span class="o">{</span>
  ! cf_is_linux &gt;/dev/null <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&quot;only works in linux&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">return</span> <span class="m">1</span>
  <span class="k">while</span> true<span class="p">;</span> <span class="k">do</span>
    <span class="nb">echo</span> <span class="s2">&quot;entropy available:&quot;</span> <span class="sb">`</span>cat /proc/sys/kernel/random/entropy_avail<span class="sb">`</span>
    sleep <span class="m">1</span>
  <span class="k">done</span>
<span class="o">}</span>

<span class="k">function</span> cf_json_fmt<span class="o">()</span> <span class="o">{</span>
  python -mjson.tool
<span class="o">}</span>

<span class="k">function</span> cf_http_server<span class="o">()</span> <span class="o">{</span>
  <span class="nb">local</span> <span class="nv">port</span><span class="o">=</span><span class="si">${</span><span class="nv">1</span><span class="k">:-</span><span class="nv">8000</span><span class="si">}</span>
  python -mSimpleHTTPServer <span class="nv">$port</span> <span class="m">2</span>&gt;/dev/null
<span class="o">}</span>
</code></pre></div>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../linux%E5%91%BD%E4%BB%A4%E5%88%86%E7%B1%BB%E5%8F%82%E8%80%83/" title="Linux命令分类参考" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  上一页
                </span>
                Linux命令分类参考
              </div>
            </div>
          </a>
        
        
          <a href="../../Python/pyenv%E7%9A%84%E5%AE%89%E8%A3%85%E4%BF%A1%E6%81%AF/" title="Pyenv的安装信息" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  下一页
                </span>
                Pyenv的安装信息
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/vendor.d710d30a.min.js"></script>
      <script src="../../../assets/javascripts/bundle.b39636ac.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "\u590d\u5236", "clipboard.copied": "\u5df2\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stemmer", "search.config.separator": "[\\uff0c\\u3002]+", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c"}</script>
      
      <script>
        app = initialize({
          base: "../../..",
          features: [],
          search: Object.assign({
            worker: "../../../assets/javascripts/worker/search.a68abb33.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>